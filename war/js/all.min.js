/*! WebPaige 13-04-2013 */
"use strict";angular.module("WebPaige",["$strap.directives","ngResource","WebPaige.Controllers","WebPaige.Directives","WebPaige.Filters","WebPaige.Modals","WebPaige.Services"]).value("$config",{title:"WebPaige",version:"2.0.2 (snapshot)",lang:"nl",demo_users:!1,profile:{meta:profile.meta,title:profile.title,logos:{login:"js/profiles/"+profile.meta+"/img/login_logo.png",app:""},background:"js/profiles/"+profile.meta+"/img/login_bg.jpg",p2000:profile.p2000},statesall:{"com.ask-cs.State.Available":{className:"state-available",label:"Beschikbaar",color:"#4f824f",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarNoord":{className:"state-available-north",label:"Beschikbaar voor Noord",color:"#000",type:"Beschikbaar"},"com.ask-cs.State.KNRM.BeschikbaarZuid":{className:"state-available-south",label:"Beschikbaar voor Zuid",color:"#e08a0c",type:"Beschikbaar"},"com.ask-cs.State.Unavailable":{className:"state-unavailable",label:"Niet Beschikbaar",color:"#a93232",type:"Niet Beschikbaar"},"com.ask-cs.State.KNRM.SchipperVanDienst":{className:"state-schipper-service",label:"Schipper van Dienst",color:"#e0c100",type:"Beschikbaar"},"com.ask-cs.State.Unreached":{className:"state-unreached",label:"Niet Bereikt",color:"#65619b",type:"Niet Beschikbaar"}},host:profile.host(),formats:{date:"dd-MM-yyyy",time:"HH:mm",datetime:"dd-MM-yyyy HH:mm",datetimefull:"dd-MM-yyyy HH:mm"},roles:profile.roles,timeline:{options:{axisOnTop:!0,width:"100%",height:"auto",selectable:!0,editable:!0,style:"box",groupsWidth:"150px",eventMarginAxis:0,showCustomTime:!0,groupsChangeable:!1,showNavigation:!1,intervalMin:36e5},config:{zoom:"0.4",bar:!1,wishes:!1,legenda:{},legendarer:!1,states:{},divisions:profile.divisions,densities:{less:"#a0a0a0",even:"#ba6a24",one:"#415e6b",two:"#3d5865",three:"#344c58",four:"#2f4550",five:"#2c424c",six:"#253943",more:"#486877"}}},pie:{colors:["#415e6b","#ba6a24","#a0a0a0"]},defaults:{settingsWebPaige:{user:{language:"nl"},app:{widgets:{groups:{}}}}},cookie:{expiry:30,path:"/"},init:function(){var e=this;angular.forEach(profile.states,function(t){e.timeline.config.states[t]=e.statesall[t]})}}).config(["$locationProvider","$routeProvider","$httpProvider",function(e,t,r){t.when("/login",{templateUrl:"js/views/login.html",controller:"loginCtrl"}).when("/logout",{templateUrl:"js/views/logout.html",controller:"logoutCtrl"}).when("/dashboard",{templateUrl:"js/views/dashboard.html",controller:"dashboardCtrl"}).when("/planboard",{templateUrl:"js/views/planboard.html",controller:"planboardCtrl",resolve:{data:["$route","Slots","Storage","Dater",function(e,t,r,n){var o=r.local.periods(),a=n.current.week(),s=o.weeks[a],i=(r.local.groups(),r.local.settings());return t.all({groupId:i.app.group,division:"all",stamps:{start:s.first.timeStamp,end:s.last.timeStamp},month:n.current.month(),layouts:{user:!0,group:!0,members:!1}})}]}}).when("/messages",{templateUrl:"js/views/messages.html",controller:"messagesCtrl",resolve:{data:["$route","Messages",function(e,t){return t.query()}]},reloadOnSearch:!1}).when("/groups",{templateUrl:"js/views/groups.html",controller:"groupsCtrl",resolve:{data:["Groups",function(e){return e.query()}]},reloadOnSearch:!1}).when("/profile/:userId",{templateUrl:"js/views/profile.html",controller:"profileCtrl",resolve:{data:["$rootScope","Profile","$route","$location","Dater",function(e,t,r,n,o){if(r.current.params.userId!=e.app.resources.uuid){var a=o.getPeriods(),s=o.current.week(),i={start:a.weeks[s].first.timeStamp/1e3,end:a.weeks[s].last.timeStamp/1e3};return t.getWithSlots(r.current.params.userId,!1,i)}return t.get(r.current.params.userId,!1)}]},reloadOnSearch:!1}).when("/profile",{templateUrl:"js/views/profile.html",controller:"profileCtrl",resolve:{data:["$rootScope","$route","$location",function(e,t,r){t.current.params.userId&&r.hash()||r.path("/profile/"+e.app.resources.uuid).hash("profile")}]}}).when("/settings",{templateUrl:"js/views/settings.html",controller:"settingsCtrl",resolve:{data:["Settings",function(e){return angular.fromJson(e.get())}]}}).when("/help",{templateUrl:"js/views/help.html",controller:"helpCtrl"}).otherwise({redirectTo:"/login"}),r.responseInterceptors.push("Interceptor")}]).run(["$rootScope","$location","$timeout","Session","Dater","Storage","Messages","$config","$window",function(e,t,r,n,o,a,s,i,u){e.config=i,e.config.init(),e.browser=$.browser,angular.extend(e.browser,{screen:u.screen}),e.browser.ios?angular.extend(e.browser,{landscape:90==Math.abs(u.orientation)?!0:!1,portrait:90!=Math.abs(u.orientation)?!0:!1}):angular.extend(e.browser,{landscape:90!=Math.abs(u.orientation)?!0:!1,portrait:90==Math.abs(u.orientation)?!0:!1}),u.onresize=function(){e.browser.screen=u.screen},u.onorientationchange=function(){e.$apply(function(){e.browser.ios?angular.extend(e.browser,{landscape:90==Math.abs(u.orientation)?!0:!1,portrait:90!=Math.abs(u.orientation)?!0:!1}):angular.extend(e.browser,{landscape:90!=Math.abs(u.orientation)?!0:!1,portrait:90==Math.abs(u.orientation)?!0:!1})})},e.changeLanguage=function(t){e.ui=ui[t]},e.ui=ui[e.config.lang],a.get("periods")||o.registerPeriods(),e.app=e.app||{},e.app.resources=angular.fromJson(a.get("resources")),e.app.unreadMessages||s.unreadCount(),e.statusBar={init:function(){e.loading={status:!1,message:"Loading.."}},display:function(t){e.loading={status:!0,message:t}},off:function(){e.loading.status=!1}},e.statusBar.init(),e.notifier={init:function(t,r,n){e.browser.mobile&&1==t?u.alert(n):e.notification={status:t,type:r,message:n}},success:function(e,t){this.init(!0,"alert-success",e),t||this.destroy()},error:function(e,t){this.init(!0,"alert-danger",e),t||this.destroy()},destroy:function(){setTimeout(function(){e.notification.status=!1},5e3)}},e.notifier.init(!1,"",""),e.$on("$routeChangeStart",function(){n.check()||t.path("/login"),e.loadingBig=!0,e.statusBar.display("Loading.."),$("div[ng-view]").hide()}),e.$on("$routeChangeSuccess",function(){e.newLocation=t.path(),e.loadingBig=!1,e.statusBar.off(),$("div[ng-view]").show()}),e.$on("$routeChangeError",function(t,r,n,o){e.notifier.error("ROUTE CHANGE ERROR: "+o)}),e.fixStyles=function(){($.os.mac||$.os.linux)&&$(".nav-tabs-app li a span").css({paddingTop:"10px",marginBottom:"0px"})}}]),angular.module("WebPaige.Modals",["ngResource"]).factory("User",["$resource","$config","$q","$location","Storage","$rootScope",function(e,t,r,n,o){var a=e(),s=e(t.host+"/login",{},{process:{method:"GET",params:{uuid:"",pass:""}}}),i=e(t.host+"/logout",{},{process:{method:"GET",params:{}}}),u=e(t.host+"/resources",{},{get:{method:"GET",params:{}}}),c=e(t.host+"/passwordReset",{},{password:{method:"GET",params:{uuid:"",path:""}}});return a.prototype.password=function(e){var t=r.defer();return c.password({uuid:e.toLowerCase(),path:n.absUrl()},function(e){angular.equals(e,[])?t.resolve("ok"):t.resolve(e)},function(e){t.resolve(e)}),t.promise},a.prototype.login=function(e,t){var n=r.defer();return s.process({uuid:e,pass:t},function(e){angular.equals(e,[])?n.reject("Something went wrong with login!"):n.resolve(e)},function(e){n.resolve(e)}),n.promise},a.prototype.changePass=function(){var e=r.defer();return changePassword.get(function(t){e.resolve(t)},function(t){e.resolve(t)}),e.promise},a.prototype.logout=function(){var e=r.defer();return i.process(null,function(t){e.resolve(t)},function(t){e.resolve({error:t})}),e.promise},a.prototype.resources=function(){var e=r.defer();return u.get(null,function(t){angular.equals(t,[])?e.reject("User has no resources!"):(o.add("resources",angular.toJson(t)),e.resolve(t))},function(t){e.resolve({error:t})}),e.promise},new a}]).factory("Dashboard",["$rootScope","$resource","$config","$q","Storage","Slots","Dater","Announcer",function(e,t,r,n,o,a,s,i){var u=t("http://knrm.myask.me/rpc/client/p2000.php",{},{p2000:{method:"GET",params:{},isArray:!0}});return u.prototype.pies=function(){var t=n.defer(),r=angular.fromJson(o.get("groups")),s=o.local.settings().app.widgets.groups,i=[],u=((new Date.now).getTime(),[]);return 0==s.length&&console.warn("no settings"),angular.forEach(r,function(e){s[e.uuid]&&i.push({id:e.uuid,name:e.name})}),angular.forEach(i,function(e){u.push(a.pie({id:e.id,name:e.name}))}),n.all(u).then(function(r){e.statusBar.off(),t.resolve(r)}),t.promise},u.prototype.p2000=function(){var e=n.defer();return $.ajax({url:r.profile.p2000.url,dataType:"jsonp",success:function(t){e.resolve(i.process(t))},error:function(){e.resolve({error:error})}}),e.promise},new u}]).factory("Slots",["$rootScope","$config","$resource","$q","Storage","Dater","Sloter","Stats",function(e,t,r,n,o,a,s,i){function u(e){var t=angular.fromJson(e.content);return{start:new Date(e.start).getTime()/1e3,end:new Date(e.end).getTime()/1e3,recursive:t.recursive,text:t.state,id:t.id}}var c=r(t.host+"/askatars/:user/slots",{user:""},{query:{method:"GET",params:{start:"",end:""},isArray:!0},change:{method:"PUT",params:{start:"",end:"",text:"",recursive:""}},save:{method:"POST",params:{}},remove:{method:"DELETE",params:{}}}),l=r(t.host+"/calc_planning/:id",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0}}),d=r(t.host+"/network/:id/wish",{},{query:{method:"GET",params:{id:"",start:"",end:""},isArray:!0},save:{method:"PUT",params:{id:""}}});return c.prototype.wishes=function(e){var t=n.defer(),r={id:e.id,start:e.start,end:e.end};return d.query(r,function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},c.prototype.setWish=function(e){var t=n.defer(),r={start:e.start,end:e.end,wish:e.wish,recurring:e.recursive};return d.save({id:e.id},r,function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},c.prototype.aggs=function(e){var t=n.defer(),r={id:e.id,start:e.start,end:e.end};return void 0!=e.division&&(r.stateGroup=e.division),l.query(r,function(n){var o=i.aggs(n);c.prototype.wishes(r).then(function(r){t.resolve({id:e.id,division:e.division,wishes:r,data:n,ratios:o.ratios,durations:o.durations})})},function(e){t.resolve({error:e})}),t.promise},c.prototype.pie=function(e){var r=n.defer(),o=Math.floor(Date.now().getTime()/1e3),s=a.getPeriods(),u=a.current.week(),c={current:{period:s.weeks[u],data:[],shortages:[]},next:{period:s.weeks[u+1],data:[],shortages:[]}},d=c.current.period.last.timeStamp;return l.query({id:e.id,start:c.current.period.first.timeStamp/1e3,end:c.next.period.last.timeStamp/1e3},function(n){var a;if(n.length>1){angular.forEach(n,function(e){o>=e.start&&e.end>=o&&(a=e),1e3*e.start>=d?c.next.data.push(e):d>=1e3*e.start&&c.current.data.push(e)});var s=c.current.data[c.current.data.length-1],u=(c.next.data[0],(1e3*s.end-d)/1e3),l=[];c.current.data[0].start=c.current.period.first.timeStamp/1e3,u>0&&(s.end=d/1e3,c.next.data.unshift({diff:s.diff,start:d/1e3,end:s.end,wish:s.wish})),angular.forEach(c.current.data,function(e){e.end-e.start>0&&l.push(e),0>e.diff&&c.current.shortages.push(e)}),l[0].start=c.current.period.first.timeStamp/1e3,angular.forEach(c.next.data,function(e){0>e.diff&&c.next.shortages.push(e)}),r.resolve({id:e.id,name:e.name,weeks:{current:{data:l,state:a,shortages:c.current.shortages,start:{date:new Date(c.current.period.first.timeStamp).toString(t.formats.date),timeStamp:c.current.period.first.timeStamp},end:{date:new Date(c.current.period.last.timeStamp).toString(t.formats.date),timeStamp:c.current.period.last.timeStamp},ratios:i.pies(l)},next:{data:c.next.data,shortages:c.next.shortages,start:{date:new Date(c.next.period.first.timeStamp).toString(t.formats.date),timeStamp:c.next.period.first.timeStamp},end:{date:new Date(c.next.period.last.timeStamp).toString(t.formats.date),timeStamp:c.next.period.last.timeStamp},ratios:i.pies(c.next.data)}}})}else{null==n[0].diff&&(n[0].diff=0),null==n[0].wish&&(n[0].wish=0);var g=[{start:c.current.period.first.timeStamp/1e3,end:c.current.period.last.timeStamp/1e3,wish:n[0].wish,diff:n[0].diff}],f=[{start:c.next.period.first.timeStamp/1e3,end:c.next.period.last.timeStamp/1e3,wish:n[0].wish,diff:n[0].diff}];0>g[0].diff&&c.current.shortages.push(g[0]),0>f[0].diff&&c.next.shortages.push(f[0]),r.resolve({id:e.id,name:e.name,weeks:{current:{data:g,state:g,shortages:c.current.shortages,start:{date:new Date(c.current.period.first.timeStamp).toString(t.formats.date),timeStamp:c.current.period.first.timeStamp},end:{date:new Date(c.current.period.last.timeStamp).toString(t.formats.date),timeStamp:c.current.period.last.timeStamp},ratios:i.pies(g)},next:{data:f,shortages:c.next.shortages,start:{date:new Date(c.next.period.first.timeStamp).toString(t.formats.date),timeStamp:c.next.period.first.timeStamp},end:{date:new Date(c.next.period.last.timeStamp).toString(t.formats.date),timeStamp:c.next.period.last.timeStamp},ratios:i.pies(f)}}})}},function(e){r.resolve({error:e})}),r.promise},c.prototype.all=function(e){var t=n.defer(),r=(a.getPeriods(),{user:angular.fromJson(o.get("resources")).uuid,start:e.stamps.start/1e3,end:e.stamps.end/1e3});return c.query(r,function(a){if(e.layouts.group){var s={id:e.groupId,start:r.start,end:r.end,month:e.month};"all"!=e.division&&(s.division=e.division),c.prototype.aggs(s).then(function(s){if(e.layouts.members){var i=angular.fromJson(o.get(e.groupId)),u=[];angular.forEach(i,function(e){u.push(c.prototype.user({user:e.uuid,start:r.start,end:r.end,type:"both"}))}),n.all(u).then(function(r){t.resolve({user:a,groupId:e.groupId,aggs:s,members:r,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})})}else t.resolve({user:a,groupId:e.groupId,aggs:s,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})})}else t.resolve({user:a,synced:(new Date).getTime(),periods:{start:e.stamps.start,end:e.stamps.end}})},function(e){t.resolve({error:e})}),t.promise},c.prototype.user=function(e){var t=n.defer();return c.query(e,function(r){t.resolve({id:e.user,data:r,stats:i.member(r)})},function(e){t.resolve({error:e})}),t.promise},c.prototype.local=function(){return angular.fromJson(o.get("slots"))},c.prototype.add=function(e,t){var r=n.defer();return c.save({user:t},e,function(e){r.resolve(e)},function(e){r.resolve({error:e})}),r.promise},c.prototype.change=function(e,t,r){var o=n.defer();return c.change(angular.extend(u(t),{user:r}),u(e),function(e){o.resolve(e)},function(e){o.resolve({error:e})}),o.promise},c.prototype.remove=function(e,t){var r=n.defer();return c.remove(angular.extend(u(e),{user:t}),function(e){r.resolve(e)},function(e){r.resolve({error:e})}),r.promise},new c}]).factory("Messages",["$rootScope","$config","$resource","$q","Storage",function(e,t,r,n,o){var a=r(t.host+"/question/:action",{},{query:{method:"GET",params:{action:"",0:"dm"},isArray:!0},get:{method:"GET",params:{}},send:{method:"POST",params:{action:"sendDirectMessage"}},save:{method:"POST",params:{}},changeState:{method:"POST",params:{action:"changeState"}},remove:{method:"POST",params:{action:"deleteQuestions"}}});return a.prototype.query=function(){var e=n.defer();return a.query(function(t){o.add("messages",angular.toJson(t)),a.prototype.unreadCount(),e.resolve(a.prototype.filter(t))},function(t){e.resolve({error:t})}),e.promise},a.prototype.filter=function(e){var t={inbox:[],outbox:[],trash:[]};return angular.forEach(e,function(e){""==e.subject&&(e.subject="-No Subject-"),"inbox"==e.box&&"TRASH"!=e.state?t.inbox.push(e):"outbox"==e.box&&"TRASH"!=e.state?t.outbox.push(e):"inbox"!=e.box&&"outbox"!=e.box||"TRASH"!=e.state||t.trash.push(e)}),t},a.prototype.local=function(){return angular.fromJson(o.get("messages"))},a.prototype.find=function(e){var t;return angular.forEach(a.prototype.local(),function(r){r.uuid==e&&(t=r)}),t},a.prototype.receviers=function(){var e=angular.fromJson(o.get("members")),t=angular.fromJson(o.get("groups")),r=[];return angular.forEach(e,function(e){r.push({id:e.uuid,name:e.name,group:"Users"})}),angular.forEach(t,function(e){r.push({id:e.uuid,name:e.name,group:"Groups"})}),r},a.prototype.send=function(e,t){var r=n.defer(),o=[],s=[];angular.forEach(e.receivers,function(e){o.push(e.id)}),s.push("paige"),t.sms&&s.push("sms"),t.email&&s.push("email");var e={members:o,content:e.body,subject:e.subject,types:s};return a.send(null,e,function(e){var t="";angular.forEach(e,function(e){t+=e}),r.resolve(t)},function(e){r.resolve({error:e})}),r.promise},a.prototype.unread=function(){var e=a.prototype.local(),t=[];return angular.forEach(e,function(e){"inbox"==e.box&&"NEW"==e.state&&t.push(e)}),t},a.prototype.unreadCount=function(){var t=a.prototype.local(),r=0;angular.forEach(t,function(e){"inbox"==e.box&&"NEW"==e.state&&r++}),e.app.unreadMessages=r},a.prototype.changeState=function(e,t){var r=n.defer();if(a.changeState(null,{ids:e,state:t},function(e){r.resolve(e)},function(e){r.resolve({error:e})}),"READ"==t){var s=angular.fromJson(o.get("messages")),i=[];angular.forEach(s,function(t){angular.forEach(e,function(e){t.uuid==e&&(t.state="READ")}),i.push(t)}),o.remove("messages"),o.add(angular.toJson("messages",i)),a.prototype.unreadCount()}return r.promise},a.prototype.remove=function(e){var t=n.defer();return a.prototype.changeState(e,"TRASH").then(function(e){t.resolve(e)}),t.promise},a.prototype.restore=function(e){var t=n.defer();return a.prototype.changeState(e,"SEEN").then(function(e){t.resolve(e)}),t.promise},a.prototype.emptyTrash=function(){var e=n.defer(),t=a.prototype.local(),r=[];return angular.forEach(t,function(e){"inbox"!=e.box&&"outbox"!=e.box||"TRASH"!=e.state||r.push(e.uuid)}),a.remove(null,{members:r},function(t){e.resolve(t)},function(t){e.resolve({error:t})}),e.promise},new a}]).factory("Groups",["$resource","$config","$q","Storage","$rootScope","Slots",function(e,t,r,n,o,a){var s=e(t.host+"/network/:action/:id",{},{query:{method:"GET",params:{},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{id:""}},edit:{method:"PUT",params:{id:""}},remove:{method:"DELETE",params:{id:""}},search:{method:"POST",params:{id:"",action:"searchPaigeUser"},isArray:!0}}),i=e(t.host+"/node/:id/container",{},{get:{method:"GET",params:{id:""},isArray:!0}}),u=e(t.host+"/parent",{},{get:{method:"GET",params:{},isArray:!0}}),c=e(t.host+"/network/:id/members/:mid",{},{query:{method:"GET",params:{id:"",fields:"[role, latlong, latlong_final, settingsWebPaige]"},isArray:!0},get:{method:"GET",params:{id:""}},save:{method:"POST",params:{}},add:{method:"POST",params:{id:"",mid:""}},remove:{method:"DELETE",params:{id:"",mid:""}}});return s.prototype.parents=function(e){var t=r.defer();return u.get(null,function(r){e?t.resolve(r):0==r.length?t.resolve(null):t.resolve(r[0].uuid)},function(e){t.resolve({error:e})}),t.promise},s.prototype.containers=function(e){var t=r.defer(),n=[];return i.get({id:e},function(e){angular.forEach(e,function(e){var t=[];angular.forEach(e,function(e){t+=e}),n.push(t)}),t.resolve(n)},function(e){t.resolve({error:e})}),t.promise},s.prototype.addMember=function(e){var t=r.defer();return c.add({id:e.group.uuid,mid:e.id},{},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},s.prototype.removeMember=function(e,t){var n=r.defer();return c.remove({id:t,mid:e},function(e){n.resolve(e)},function(e){n.resolve({error:e})}),n.promise},s.prototype.removeMembers=function(e,t){var n=r.defer(),o=[];return angular.forEach(e,function(e,r){r&&o.push(s.prototype.removeMember(r,t.uuid))}),r.all(o).then(function(e){n.resolve(e)}),n.promise},s.prototype.wish=function(e){var t=r.defer(),n=0;return a.wishes({id:e,start:255600,end:860400}).then(function(e){angular.forEach(e,function(e){255600==e.start&&860400==e.end&&null!=e.count&&(n=e.count)}),t.resolve({count:n})}),t.promise},s.prototype.query=function(e){var t=r.defer();return s.query(function(o){if(n.add("groups",angular.toJson(o)),e)t.resolve(o);else{var a=[];angular.forEach(o,function(e){a.push(s.prototype.get(e.uuid))}),r.all(a).then(function(e){s.prototype.uniqueMembers();var r={};r.members={},angular.forEach(o,function(t){r.groups=o,r.members[t.uuid]=[],angular.forEach(e,function(e){e.id==t.uuid&&(r.members[t.uuid]=e.data)})}),t.resolve(r)})}},function(e){t.resolve({error:e})}),t.promise},s.prototype.get=function(e){var t=r.defer();return c.query({id:e},function(r){var o;o=4==r.length&&"n"==r[0][0]&&"u"==r[1][0]?[]:r,n.add(e,angular.toJson(o)),t.resolve({id:e,data:o})},function(e){t.resolve({error:e})}),t.promise},s.prototype.uniqueMembers=function(){angular.forEach(angular.fromJson(n.get("groups")),function(e){var t=angular.fromJson(n.get("members"))||{};angular.forEach(angular.fromJson(n.get(e.uuid)),function(e){t[e.uuid]=e}),n.add("members",angular.toJson(t))})},s.prototype.save=function(e){var t=r.defer();return e.id?s.edit({id:e.id},{name:e.name},function(){t.resolve(e.id)}):s.save({id:o.app.resources.uuid},e,function(e){var r="";angular.forEach(e,function(e){r+=e}),t.resolve(r)},function(e){t.resolve({error:e})}),t.promise},s.prototype.remove=function(e){var t=r.defer();return s.remove({id:e},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},s.prototype.search=function(e){var t=r.defer();return s.search(null,{key:e},function(e){var r=[];angular.forEach(e,function(e){r.push({id:e.id,name:e.name,groups:s.prototype.getMemberGroups(e.id)})}),t.resolve(r)},function(e){t.resolve({error:e})}),t.promise},s.prototype.getMemberGroups=function(e){var t=angular.fromJson(n.get("groups")),r=[];return angular.forEach(t,function(t){var o=angular.fromJson(n.get(t.uuid));angular.forEach(o,function(n){n.uuid===e&&r.push({uuid:t.uuid,name:t.name})})}),r},new s}]).factory("Profile",["$rootScope","$config","$resource","$q","Storage","Groups","Slots",function(e,t,r,n,o,a,s){var i=r(t.host+"/node/:id/:section",{},{get:{method:"GET",params:{id:"",section:"resource"}},save:{method:"PUT",params:{section:"resource"}},role:{method:"PUT",params:{section:"role"}}}),u=r(t.host+"/register",{direct:"true",module:"default"},{profile:{method:"GET",params:{uuid:"",pass:"",name:"",phone:""}}}),c=r(t.host+"/resources",{},{get:{method:"GET",params:{}},save:{method:"POST",params:{}}});return i.prototype.register=function(e){var t=n.defer();return u.profile({uuid:e.username,pass:MD5(e.password),name:e.name,phone:e.PhoneAddress},function(r){i.prototype.role(e.username,e.role.id).then(function(o){i.prototype.save(e.username,{EmailAddress:e.EmailAddress,PostAddress:e.PostAddress,PostZip:e.PostZip,PostCity:e.PostCity}).then(function(s){var i=[];angular.forEach(e.groups,function(t){i.push(a.addMember({id:e.username,group:t}))}),n.all(i).then(function(e){t.resolve({registered:r,roled:o,resourced:s,grouped:e})})})})},function(e){t.resolve({error:e})}),t.promise},i.prototype.role=function(e,t){var r=n.defer();return i.role({id:e},t,function(e){r.resolve(e)},function(e){r.resolve({error:e})}),r.promise},i.prototype.changePassword=function(e){var t=n.defer();return c.save(null,{askPass:MD5(e.new1)},function(e){t.resolve(e)},function(e){t.resolve({error:e})}),t.promise},i.prototype.get=function(t,r){var a=n.defer();return i.get({id:t},function(n){t==e.app.resources.uuid&&(e.app.resources=n),r&&o.add("resources",angular.toJson(n)),a.resolve({resources:n})}),a.promise},i.prototype.getWithSlots=function(e,t,r){var o=n.defer();return i.prototype.get(e,t).then(function(t){s.user({user:e,start:r.start,end:r.end}).then(function(e){o.resolve(angular.extend(t,{slots:e,synced:(new Date).getTime(),periods:{start:r.start,end:r.end}}))})}),o.promise},i.prototype.getSlots=function(e,t){var r=n.defer();return s.user({user:e,start:t.start,end:t.end}).then(function(e){r.resolve({slots:e,synced:(new Date).getTime(),periods:{start:t.start,end:t.end}})}),r.promise},i.prototype.local=function(){return angular.fromJson(o.get("resources"))},i.prototype.save=function(e,t){var r=n.defer();return i.save({id:e},t,function(e){r.resolve(e)},function(e){r.resolve({error:e})}),r.promise},i.prototype.createSettings_=function(t){var r=n.defer();return i.prototype.get(t,!1).then(function(t){void 0==t.settingsWebPaige||null==t.settingsWebPaige?i.save({id:t.resources.uuid},angular.toJson({settingsWebPaige:e.config.defaults.settingsWebPaige}),function(e){r.resolve({status:"modified",resources:e})},function(e){r.resolve({error:e})}):r.resolve({status:"full",resources:t})}),r.promise},new i}]).factory("Settings",["$rootScope","$config","$resource","$q","Storage","Profile",function(e,t,r,n,o,a){var s=r();return s.prototype.get=function(){return angular.fromJson(o.get("resources")).settingsWebPaige||{}},s.prototype.save=function(e,t){var r=n.defer();return a.save(e,{settingsWebPaige:angular.toJson(t)}).then(function(){r.resolve({saved:!0})}),r.promise},new s}]),angular.module("WebPaige.Controllers",[]).controller("loginCtrl",["$rootScope","$location","$q","$scope","Session","User","Groups","Messages","Storage","$routeParams","Settings","Profile","MD5",function(e,t,r,n,o,a,s,i,u,c,l,d,g){function f(){m.progress(100,e.ui.login.loading_everything),m.redirectToDashboard(),m.getMessages(),m.getMembers()}var m=this;c.uuid&&c.key?(n.views={changePass:!0},n.changepass={uuid:c.uuid,key:c.key}):n.views={login:!0,forgot:!1},e.config.demo_users&&(n.demo_users=demo_users),n.knrmLogin=function(e){$("#login button[type=submit]").text("Login..").attr("disabled","disabled"),m.auth(e.uuid,e.resources.askPass)},n.alert={login:{display:!1,type:"",message:""},forgot:{display:!1,type:"",message:""}},u.session.get("app")||u.session.add("app","{}"),$(".navbar").hide(),$("#footer").hide(),$("#watermark").hide(),$("body").css({background:"url(../"+e.config.profile.background+") no-repeat center center fixed",backgroundSize:"cover"});var p=angular.fromJson(u.get("logindata"));p&&p.remember&&(n.logindata=p),n.login=function(){return $("#alertDiv").hide(),n.logindata&&n.logindata.username&&n.logindata.password?($("#login button[type=submit]").text("Login..").attr("disabled","disabled"),u.add("logindata",angular.toJson({username:n.logindata.username,password:n.logindata.password,remember:n.logindata.remember})),m.auth(n.logindata.username,g(n.logindata.password)),void 0):(n.alert={login:{display:!0,type:"alert-error",message:e.ui.login.alert_fillfiled}},$("#login button[type=submit]").text("Login").removeAttr("disabled"),!1)},m.auth=function(t,r){a.login(t.toLowerCase(),r).then(function(t){return 400==t.status?(n.alert={login:{display:!0,type:"alert-error",message:e.ui.login.alert_wrongUserPass}},$("#login button[type=submit]").text("Login").removeAttr("disabled"),!1):(o.set(t["X-SESSION_ID"]),m.preloader(),void 0)})},m.preloader=function(){$("#login").hide(),$("#download").hide(),$("#preloader").show(),m.progress(30,e.ui.login.loading_User),a.resources().then(function(t){t.error?console.warn("error ->",t):(e.app.resources=t,m.progress(70,e.ui.login.loading_Group),s.query(!0).then(function(r){if(r.error)console.warn("error ->",r);else{var n=angular.fromJson(t.settingsWebPaige)||{},o=!1,i=!1,u=e.config.defaults.settingsWebPaige,c=function(e){var t={};return angular.forEach(e,function(e){t[e.uuid]=!0}),t};null!=n||void 0!=n?(n.user?n.user.language?(e.changeLanguage(angular.fromJson(t.settingsWebPaige).user.language),u.user.language=n.user.language):(e.changeLanguage(e.config.defaults.settingsWebPaige.user.language),o=!0):o=!0,n.app?(n.app.widgets?n.app.widgets.groups?u.app.widgets.groups=n.app.widgets.groups:(u.app.widgets.groups=c(r),o=!0):(u.app.widgets={groups:c(r)},o=!0),n.app.group&&void 0!=n.app.group?u.app.group=n.app.group:(i=!0,o=!0)):(u.app={widgets:{groups:c(r)}},o=!0)):(u={user:e.config.defaults.settingsWebPaige.user,app:{widgets:{groups:c(r)},group:r[0].uuid}},o=!0),o?i?s.parents().then(function(n){u.app.group=null!=n?n:r[0].uuid,l.save(t.uuid,u).then(function(){a.resources().then(function(t){e.app.resources=t,f()})})}):(u.app.group=r[0].uuid,l.save(t.uuid,u).then(function(){a.resources().then(function(t){e.app.resources=t,f()})})):f()}}))})},m.getMembers=function(){u.local.groups(),s.query().then(function(e){var t=[];angular.forEach(e,function(e){t.push(s.get(e.uuid))}),r.all(t).then(function(){s.uniqueMembers()})})},m.getMessages=function(){i.query().then(function(t){t.error?console.warn("error ->",t):(e.app.unreadMessages=i.unreadCount(),u.session.unreadMessages=i.unreadCount())})},m.redirectToDashboard=function(){t.path("/dashboard"),setTimeout(function(){$("body").css({background:"none"}),$(".navbar").show(),e.browser.mobile||$("#footer").show(),$("#watermark").show(),$("body").css({background:"url(../img/bg.jpg) repeat"})},100)},m.progress=function(e,t){$("#preloader .progress .bar").css({width:e+"%"}),$("#preloader span").text(t)},n.forgot=function(){$("#forgot button[type=submit]").text("setting ...").attr("disabled","disabled"),a.password(n.remember.id).then(function(e){n.alert="ok"==e?{forget:{display:!0,type:"alert-success",message:"Please check your email to reset your password!"}}:{forget:{display:!0,type:"alert-error",message:"Error, we can not find this account !"}},$("#forgot button[type=submit]").text("change password").removeAttr("disabled")})},m.changePass=function(e,r,o){a.changePass(e,r,o).then(function(e){400==e.status||500==e.status||409==e.status?n.alert={changePass:{display:!0,type:"alert-error",message:"Something wrong with password changing!"}}:(n.alert={changePass:{display:!0,type:"alert-success",message:"Password changed!"}},t.path("/message")),$("#changePass button[type=submit]").text("change password").removeAttr("disabled")})},n.changePass=function(){return $("#alertDiv").hide(),n.changeData&&n.changeData.newPass&&n.changeData.retypePass?n.changeData.newPass!=n.changeData.retypePass?(n.alert={changePass:{display:!0,type:"alert-error",message:"Please make the reType password is indentical !"}},$("#changePass button[type=submit]").text("change password").removeAttr("disabled"),!1):($("#changePass button[type=submit]").text("changing ...").attr("disabled","disabled"),m.changePass(n.changepass.uuid,g(n.changeData.newPass),n.changepass.key),void 0):(n.alert={changePass:{display:!0,type:"alert-error",message:"Please fill all fields!"}},$("#changePass button[type=submit]").text("change password").removeAttr("disabled"),!1)}}]).controller("logoutCtrl",["$rootScope","$scope","$window","Session","User","Storage",function(e,t,r,n,o,a){$(".navbar").hide(),$("#footer").hide();var s=angular.fromJson(a.get("logindata"));o.logout().then(function(e){e.error?console.warn("error ->",e):(a.clearAll(),a.session.clearAll(),a.add("logindata",angular.toJson(s)),r.location.href="logout.html")})}]).controller("dashboardCtrl",["$scope","$rootScope","$q","Dashboard","Slots","Dater","Storage","Settings","Profile",function(e,t,r,n,o,a,s,i,u){function c(){n.pies().then(function(r){r.error?(t.notifier.error("Error with getting group overviews."),console.warn("error ->",result)):(e.shortageHolders={},e.loading.pies=!1,e.periods={start:r[0].weeks.current.start.date,end:r[0].weeks.next.end.date},angular.forEach(r,function(r){null==r.weeks.current.state.diff&&(r.weeks.current.state.diff=0),null==r.weeks.current.state.wish&&(r.weeks.current.state.wish=0),r.weeks.current.state.diff>0?r.weeks.current.state.cls="more":0==r.weeks.current.state.diff?r.weeks.current.state.cls="even":0>r.weeks.current.state.diff&&(r.weeks.current.state.cls="less"),r.weeks.current.state.start=void 0!=r.weeks.current.state.start?new Date(1e3*r.weeks.current.state.start).toString(t.config.formats.datetime):"undefined",r.weeks.current.state.end=void 0!=r.weeks.current.state.end?new Date(1e3*r.weeks.current.state.end).toString(t.config.formats.datetime):"undefined",r.shortages={current:r.weeks.current.shortages,next:r.weeks.next.shortages,total:r.weeks.current.shortages.length+r.weeks.next.shortages.length},r.state=r.weeks.current.state,delete r.weeks.current.shortages,delete r.weeks.current.state,e.shortageHolders["shortages-"+r.id]=!1}),e.pies=r)}).then(function(){function t(e,t,r,n){setTimeout(function(){document.getElementById(e+t).innerHTML="";var r=[],o={more:"#415e6b",even:"#ba6a24",less:"#a0a0a0"},a=[],s=[];angular.forEach(n,function(e,t){0!=e&&r.push({ratio:e,color:o[t]})}),r=r.sort(function(e,t){return t.ratio-e.ratio}),angular.forEach(r,function(e){a.push(e.color),s.push(e.ratio)
});var i=Raphael(e+t);i.piechart(40,40,40,s,{colors:a})},100)}angular.forEach(e.pies,function(e){t("weeklyPieCurrent-",e.id,e.name,e.weeks.current.ratios),t("weeklyPieNext-",e.id,e.name,e.weeks.next.ratios)})})}t.fixStyles(),e.loading={pies:!0,alerts:!0},e.more={status:!1,text:"show more"};var l=s.local.groups(),d=(s.local.settings(),{});angular.forEach(s.local.settings().app.widgets.groups,function(e,t){d[t]=e}),e.popover={groups:l,selection:d},c(),e.saveOverviewWidget=function(e){t.statusBar.display(t.ui.settings.saving),i.save(t.app.resources.uuid,{user:s.local.settings().user,app:{widgets:{groups:e}}}).then(function(){t.statusBar.display("Refreshing group overviews.."),u.get(t.app.resources.uuid,!0).then(function(){c()})})},n.p2000().then(function(r){r.error?(t.notifier.error("Error with getting p2000 alarm messages."),console.warn("error ->",r)):(e.loading.alerts=!1,e.alarms=r,e.alarms.list=e.alarms.short)}),e.toggle=function(t){e.alarms.list=t?e.alarms.short:e.alarms.long,e.more.text=t?"show more":"show less",e.more.status=!e.more.status}}]).controller("planboardCtrl",["$rootScope","$scope","$q","$window","$location","data","Slots","Dater","Storage","Sloter",function(e,t,r,n,o,a,s,i,u,c){function l(){t.views={slot:{add:!1,edit:!1},group:!1,wish:!1,member:!1}}function d(){var e=w.timeline.getVisibleChartRange();t.$apply(function(){t.timeline.range={start:""+new Date(e.from),end:""+new Date(e.till)},t.daterange={start:i.readable.date(new Date(e.start).getTime()),end:i.readable.date(new Date(e.end).getTime())}})}function g(){var r;if(D.cancelAdd(),r=w.timeline.getSelection()[0]){var n=w.timeline.getItem(r.row),o=angular.fromJson(n.content.match(/<span class="secret">(.*)<\/span>/)[1]);switch(t.original={start:n.start,end:n.end,content:{recursive:o.recursive,state:o.state,id:o.id}},l(),o.type){case"slot":t.views.slot.edit=!0;break;case"group":t.views.group=!0;break;case"wish":t.views.wish=!0;break;case"member":t.views.member=!0}switch(t.slot={start:{date:new Date(n.start).toString(e.config.formats.date),time:new Date(n.start).toString(e.config.formats.time),datetime:new Date(n.start).toISOString()},end:{date:new Date(n.end).toString(e.config.formats.date),time:new Date(n.end).toString(e.config.formats.time),datetime:new Date(n.end).toISOString()},state:o.state,recursive:o.recursive,id:o.id},o.type){case"group":t.slot.diff=o.diff,t.slot.group=o.group;break;case"wish":t.slot.wish=o.wish,t.slot.group=o.group,t.slot.groupId=o.groupId;break;case"member":t.slot.member=o.mid}return n}}function f(){t.$apply(function(){t.selectedOriginal=g()})}function m(){var r=$(".timeline-event-content").contents().filter(function(){return"New"==this.nodeValue}),n=w.timeline.getItem(w.timeline.getSelection()[0].row);r.length>1&&w.timeline.cancelAdd(),t.$apply(function(){l(),t.views.slot.add=!0,t.slot={start:{date:new Date(n.start).toString(e.config.formats.date),time:new Date(n.start).toString(e.config.formats.time),datetime:new Date(n.start).toISOString()},end:{date:new Date(n.end).toString(e.config.formats.date),time:new Date(n.end).toString(e.config.formats.time),datetime:new Date(n.end).toISOString()},recursive:n.group.match(/recursive/)?!0:!1,state:"com.ask-cs.State.Available"}})}function p(r,n,o,a){if(!r)var i=w.timeline.getItem(w.timeline.getSelection()[0].row),a={start:i.start,end:i.end,content:angular.fromJson(i.content.match(/<span class="secret">(.*)<\/span>/)[1])};var u=Date.now().getTime();u>=a.end&&0==a.content.recursive?(e.notifier.error("You can not change timeslots in past."),D.refresh()):(e.statusBar.display(e.ui.planboard.changingSlot),s.change(t.original,a,e.app.resources.uuid).then(function(t){t.error?(e.notifier.error("Error with changing timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.slotChanged),D.refresh()}))}function h(){var r=$(".timeline-event-content").contents().filter(function(){return"New"==this.nodeValue});if(r.length>0)w.timeline.cancelAdd(),t.$apply(function(){t.resetInlineForms()});else{var n=Date.now().getTime();n>=t.original.end.getTime()&&0==t.original.recursive?(e.notifier.error("You can not delete timeslots in past."),D.refresh()):(e.statusBar.display(e.ui.planboard.deletingTimeslot),s.remove(t.original,e.app.resources.uuid).then(function(t){t.error?(e.notifier.error("Error with removing timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.timeslotDeleted),D.refresh()}))}}e.fixStyles();var w=this,v=i.getPeriods(),y=u.local.groups(),b=u.local.settings(),S={layouts:{user:!0,group:!0,members:!1},day:i.current.today(),week:i.current.week(),month:i.current.month(),group:b.app.group,division:"all"};l(),t.toggleSlotForm=function(){t.views.slot.add?t.resetInlineForms():(t.slot={},l(),t.views.slot.add=!0)},t.resetInlineForms=function(){t.slot={},t.original={},l()},t.slot={},t.data=a,t.timeline={current:S,options:{start:new Date(v.weeks[S.week].first.day),end:new Date(v.weeks[S.week].last.day),min:new Date(v.weeks[S.week].first.day),max:new Date(v.weeks[S.week].last.day)},range:{start:v.weeks[S.week].first.day,end:v.weeks[S.week].last.day},scope:{day:!1,week:!0,month:!1},config:{bar:e.config.timeline.config.bar,wishes:e.config.timeline.config.wishes,legenda:{},legendarer:e.config.timeline.config.legendarer,states:e.config.timeline.config.states,divisions:e.config.timeline.config.divisions,densities:e.config.timeline.config.densities}},angular.forEach(e.config.timeline.config.states,function(e,r){t.timeline.config.legenda[r]=!0}),t.timeline.config.legenda.groups={more:!0,even:!0,less:!0},t.daterange=i.readable.date(t.timeline.range.start)+" / "+i.readable.date(t.timeline.range.end);var k={};angular.forEach(t.timeline.config.states,function(e,t){k[t]=e.label}),t.states=k,t.groups=y,t.divisions=t.timeline.config.divisions,t.$watch(function(){var e=w.timeline.getVisibleChartRange(),r=i.calculate.diff(e);864e5>=r?t.timeline.scope={day:!0,week:!1,month:!1}:6048e5>r?t.timeline.scope={day:!1,week:!0,month:!1}:r>6048e5&&(t.timeline.scope={day:!1,week:!1,month:!0}),t.timeline.range={start:""+new Date(e.start),end:""+new Date(e.end)},t.daterange=i.readable.date(t.timeline.range.start)+" / "+i.readable.date(t.timeline.range.end)});var D={init:function(){w.timeline=new links.Timeline(document.getElementById("mainTimeline")),links.events.addListener(w.timeline,"rangechanged",d),links.events.addListener(w.timeline,"add",m),links.events.addListener(w.timeline,"delete",h),links.events.addListener(w.timeline,"change",p),links.events.addListener(w.timeline,"select",f),this.render(t.timeline.options)},render:function(r){t.timeline={current:t.timeline.current,scope:t.timeline.scope,config:t.timeline.config,options:{start:new Date(r.start),end:new Date(r.end),min:new Date(r.start),max:new Date(r.end)}},angular.extend(t.timeline.options,e.config.timeline.options),w.timeline.draw(c.process(t.data,t.timeline.config,t.divisions,e.app.resources.role),t.timeline.options),w.timeline.setVisibleChartRange(t.timeline.options.start,t.timeline.options.end)},load:function(r){var n=this;e.statusBar.display(e.ui.planboard.refreshTimeline),s.all({groupId:t.timeline.current.group,division:t.timeline.current.division,layouts:t.timeline.current.layouts,month:t.timeline.current.month,stamps:r}).then(function(o){o.error?(e.notifier.error("Error with gettings timeslots."),console.warn("error ->",result)):(t.data=o,n.render(r)),e.statusBar.off()})},refresh:function(){t.slot={},l(),t.views.slot.add=!0,this.load({start:a.periods.start,end:a.periods.end})},redraw:function(){w.timeline.redraw()},cancelAdd:function(){w.timeline.cancelAdd()}};D.init(),e.$on("timeliner",function(){D.load({start:new Date(arguments[1].start).getTime(),end:new Date(arguments[1].end).getTime()})}),t.requestTimeline=function(e){switch(e){case"group":t.timeline.current.layouts.group=!t.timeline.current.layouts.group,t.timeline.current.layouts.members&&!t.timeline.current.layouts.group&&(t.timeline.current.layouts.members=!1);break;case"members":t.timeline.current.layouts.members=!t.timeline.current.layouts.members,t.timeline.current.layouts.members&&!t.timeline.current.layouts.group&&(t.timeline.current.layouts.group=!0)}D.load({start:a.periods.start,end:a.periods.end})},t.timelineScoper=function(e){switch(t.timeline.current.day=S.day,t.timeline.current.week=S.week,t.timeline.current.month=S.month,e){case"day":t.timeline.scope={day:!0,week:!1,month:!1},D.load({start:v.days[t.timeline.current.day].first.timeStamp,end:v.days[t.timeline.current.day].last.timeStamp});break;case"week":t.timeline.scope={day:!1,week:!0,month:!1},D.load({start:v.weeks[t.timeline.current.week].first.timeStamp,end:v.weeks[t.timeline.current.week].last.timeStamp});break;case"month":t.timeline.scope={day:!1,week:!1,month:!0},D.load({start:v.months[t.timeline.current.month].first.timeStamp,end:v.months[t.timeline.current.month].last.timeStamp})}},t.timelineBefore=function(){t.timeline.scope.day?1!=t.timeline.current.day&&(t.timeline.current.day--,D.load({start:v.days[t.timeline.current.day].first.timeStamp,end:v.days[t.timeline.current.day].last.timeStamp})):t.timeline.scope.week?1!=t.timeline.current.week&&(t.timeline.current.week--,D.load({start:v.weeks[t.timeline.current.week].first.timeStamp,end:v.weeks[t.timeline.current.week].last.timeStamp})):t.timeline.scope.month&&1!=t.timeline.current.month&&(t.timeline.current.month--,D.load({start:v.months[t.timeline.current.month].first.timeStamp,end:v.months[t.timeline.current.month].last.timeStamp}))},t.timelineAfter=function(){t.timeline.scope.day?t.timeline.current.day!=v.days.total&&(t.timeline.current.day++,D.load({start:v.days[t.timeline.current.day].first.timeStamp,end:v.days[t.timeline.current.day].last.timeStamp})):t.timeline.scope.week?53!=t.timeline.current.week&&(t.timeline.current.week++,D.load({start:v.weeks[t.timeline.current.week].first.timeStamp,end:v.weeks[t.timeline.current.week].last.timeStamp})):t.timeline.scope.month&&12!=t.timeline.current.month&&(t.timeline.current.month++,D.load({start:v.months[t.timeline.current.month].first.timeStamp,end:v.months[t.timeline.current.month].last.timeStamp}))},t.timelineZoomIn=function(){w.timeline.zoom(e.config.timeline.config.zoom,Date.now())},t.timelineZoomOut=function(){w.timeline.zoom(-e.config.timeline.config.zoom,Date.now())},t.add=function(t){var r=Date.now().getTime(),n={start:e.browser.mobile?new Date(t.start.datetime).getTime()/1e3:i.convert.absolute(t.start.date,t.start.time,!0),end:e.browser.mobile?new Date(t.end.datetime).getTime()/1e3:i.convert.absolute(t.end.date,t.end.time,!0),recursive:t.recursive?!0:!1,text:t.state};r>=1e3*n.end&&0==n.recursive?(e.notifier.error("You can not input timeslots in past."),D.refresh()):(e.statusBar.display(e.ui.planboard.addTimeSlot),s.add(n,e.app.resources.uuid).then(function(t){t.error?(e.notifier.error("Error with adding a new timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.slotAdded),D.refresh()}))},t.change=function(t,r){p(!0,t,r,{start:e.browser.mobile?new Date(r.start.datetime).getTime():i.convert.absolute(r.start.date,r.start.time,!1),end:e.browser.mobile?new Date(r.end.datetime).getTime():i.convert.absolute(r.end.date,r.end.time,!1),content:angular.toJson({recursive:r.recursive,state:r.state})})},t.setWish=function(t){e.statusBar.display(e.ui.planboard.changingWish),s.setWish({id:t.groupId,start:e.browser.mobile?new Date(t.start.datetime).getTime()/1e3:i.convert.absolute(t.start.date,t.start.time,!0),end:e.browser.mobile?new Date(t.end.datetime).getTime()/1e3:i.convert.absolute(t.end.date,t.end.time,!0),recursive:!1,wish:t.wish}).then(function(t){t.error?(e.notifier.error("Error with changing wish value."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.wishChanged),D.refresh()})},t.remove=function(){h()},n.onresize=function(){w.timeline.redraw()},t.barCharts=function(){t.timeline.config.bar=!t.timeline.config.bar,D.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.groupWishes=function(){t.timeline.config.wishes=!t.timeline.config.wishes,D.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.showLegenda=function(){t.timeline.config.legendarer=!t.timeline.config.legendarer},t.alterLegenda=function(e){t.timeline.config.legenda=e,D.render({start:t.timeline.range.start,end:t.timeline.range.end})},t.sendShortageMessage=function(t){e.statusBar.display(e.ui.planboard.preCompilingStortageMessage),u.session.add("escalation",angular.toJson({group:t.group,start:{date:t.start.date,time:t.start.time},end:{date:t.end.date,time:t.end.time},diff:t.diff})),o.path("/messages").search({escalate:!0}).hash("compose")},t.destroy={timeline:function(){},statistics:function(){setTimeout(function(){D.redraw()},10)}}}]).controller("messagesCtrl",["$scope","$rootScope","$q","$location","$route","data","Messages","Storage",function(e,t,r,n,o,a,s,i){function u(t){e.views={compose:!1,message:!1,inbox:!1,outbox:!1,trash:!1},e.views[t]=!0}function c(r){if(t.statusBar.display(t.ui.message.loadingMessage),u("message"),e.setViewTo("message"),e.message=s.find(r),"NEW"==e.message.state&&"inbox"==e.message.box){s.changeState([r],"READ").then(function(e){e.error?(t.notifier.error("Error with changing message state."),console.warn("error ->",e)):console.log("state changed")});var n=[];angular.forEach(e.messages.inbox,function(t){t.uuid==e.message.uuid&&(t.state="READ"),n.push(t)}),e.messages.inbox=n,s.unreadCount()}t.statusBar.off()}if(t.fixStyles(),e.receviersList=s.receviers(),e.messages=a,e.selection={inbox:{},outbox:{},trash:{}},e.selectionMaster={inbox:"",outbox:"",trash:""},e.broadcast={sms:!1,email:!1},e.origin="inbox",e.setViewTo=function(t){e.$watch(t,function(){n.hash(t),u(t)})},n.hash())var l=n.hash();else{var l="inbox";n.hash("inbox")}if(u(l),n.search().uuid&&c(n.search().uuid),e.requestMessage=function(t,r){e.origin=r,c(t),e.$watch(n.search(),function(){n.search({uuid:t})})},e.composeMessage=function(){e.views.compose?e.closeTabs():(e.message={},e.setViewTo("inbox"))},e.closeTabs=function(){e.message={},n.search({}),u(e.origin),e.setViewTo(e.origin),i.session.remove("escalation")},e.toggleSelection=function(t,r,n){var o=n?!0:!1;angular.forEach(t,function(t){e.selection[r][t.uuid]=o})},e.removeMessage=function(r){t.statusBar.display(t.ui.message.removing);var n=[];n.push(r),s.remove(n).then(function(r){r.error?(t.notifier.error("Error with removing message."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.removed),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(r){e.messages=r,t.loading=!1,e.closeTabs(),t.statusBar.off()}))})},e.removeMessages=function(r){t.statusBar.display(t.ui.message.removingSelected);var n=[];angular.forEach(r,function(e,t){e&&n.push(t)}),s.remove(n).then(function(r){r.error?(t.notifier.error("Error with removing messages."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.removed),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(r){e.messages=r,t.statusBar.off()}))})},e.restoreMessage=function(r){t.statusBar.display(t.ui.message.restoring);var n=[];n.push(r),s.restore(n).then(function(r){r.error?(t.notifier.error("Error with restoring message."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.restored),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(r){e.messages=r,t.statusBar.off()}))})},e.restoreMessages=function(r){t.statusBar.display(t.ui.message.restoringSelected);var n=[];angular.forEach(r,function(e,t){e&&n.push(t)}),s.restore(n).then(function(r){r.error?(t.notifier.error("Error with restoring message."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.removed),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(r){e.messages=r,t.statusBar.off()}))})},e.emptyTrash=function(){t.statusBar.display(t.ui.message.emptying),s.emptyTrash().then(function(r){r.error?(t.notifier.error("Error with emting trash."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.empited),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(r){r.error?(t.notifier.error("Error with getting messages."),console.warn("error ->",r)):(e.messages=r,t.statusBar.off())}))})},$("div#composeTab select.chzn-select").chosen().change(function(){$.each($(this).next().find("ul li.result-selected"),function(e,t){var r=$(t).html();$.each($("div#composeTab select.chzn-select option"),function(e,t){t.innerHTML==r&&(t.selected=!0)})})}),e.reply=function(t){u("compose"),e.setViewTo("compose");var r=angular.fromJson(i.get("members")),n=t.requester.split("personalagent/")[1].split("/")[0],o=r[n]===void 0?n:r[n].name;e.message={subject:"RE: "+t.subject,receivers:[{group:"Users",id:n,name:o}]},angular.forEach($("div#composeTab select.chzn-select option"),function(e){e.innerHTML==o&&(e.selected=!0)}),$("div#composeTab select.chzn-select").trigger("liszt:updated")},e.send=function(r,n){t.statusBar.display(t.ui.message.sending),r.receivers?s.send(r,n).then(function(r){r.error?(t.notifier.error("Error with sending message."),console.warn("error ->",r)):(t.notifier.success(t.ui.message.sent),t.statusBar.display(t.ui.message.refreshing),s.query().then(function(n){n.error?(t.notifier.error("Error with getting messages."),console.warn("error ->",n)):(e.messages=n,e.closeTabs(),e.requestMessage(r,e.origin),t.statusBar.off())}))}):(t.notifier.error(t.ui.message.noReceivers),t.statusBar.off())},n.search().escalate){var d=angular.fromJson(i.session.get("escalation")),g=d.group.split(">")[1].split("<")[0],f=d.group.split("uuid=")[1].split("#view")[0];setTimeout(function(){angular.forEach($("div#composeTab select.chzn-select option"),function(e){e.innerHTML==g&&(e.selected=!0)}),$("div#composeTab select.chzn-select").trigger("liszt:updated")},100),e.message={subject:t.ui.message.escalation,receivers:[{group:"Groups",id:f,name:g}],body:t.ui.message.escalationBody(d.diff,d.start.date,d.start.time,d.end.date,d.end.time)},e.broadcast={sms:!0}}}]).controller("groupsCtrl",["$rootScope","$scope","$location","data","Groups","Profile","$route","$routeParams","Storage","Slots",function(e,t,r,n,o,a,s,i,u,c){function l(e){angular.forEach(n.groups,function(r){r.uuid==e&&(t.group=r)}),t.members=n.members[e],t.current=e,d(e)}function d(e){t.wished=!1,o.wish(e).then(function(r){t.wished=!0,t.wish=r.count,t.popover={id:e,wish:r.count}})}function g(e){t.views={view:!1,add:!1,edit:!1,search:!1,member:!1},t.views[e]=!0}e.fixStyles();var f=r.search();if(t.search={query:""},t.selection={},t.data=n,t.roles=e.config.roles,t.groups=n.groups,f.uuid||r.hash())var m=f.uuid,p=r.hash();else{var m=n.groups[0].uuid,p="view";r.search({uuid:n.groups[0].uuid}).hash("view")}l(m),g(p),t.saveWish=function(t,r){console.warn("setting the wish:"+r+" for the group:",t),e.statusBar.display(e.ui.planboard.changingWish),c.setWish({id:t,start:255600,end:860400,recursive:!0,wish:r}).then(function(r){r.error?(e.notifier.error("Error with changing wish value."),console.warn("error ->",r)):e.notifier.success(e.ui.planboard.wishChanged),d(t)})},t.requestGroup=function(e,n){l(e),t.$watch(r.search(),function(){r.search({uuid:e})}),n&&("view"!=r.hash()&&r.hash("view"),g("view"))},t.setViewTo=function(e){t.$watch(e,function(){r.hash(e),g(e)})},t.addGroupForm=function(){t.views.add?t.closeTabs():(t.groupForm={},t.setViewTo("add"))},t.newMemberForm=function(){t.views.member?t.closeTabs():(t.memberForm={},t.setViewTo("member"))},t.editGroup=function(e){t.setViewTo("edit"),t.groupForm={id:e.uuid,name:e.name}},t.closeTabs=function(){t.groupForm={},t.memberForm={},t.setViewTo("view")},t.searchMembers=function(r){e.statusBar.display(e.ui.groups.searchingMembers),o.search(r).then(function(n){n.error?(e.notifier.error("Error with search."),console.warn("error ->",n)):(t.search={query:"",queried:r},t.candidates=n,t.setViewTo("search"),e.statusBar.off())})},t.addMember=function(r){e.statusBar.display(e.ui.groups.addingNewMember),o.addMember(r).then(function(r){r.error?(e.notifier.error("Error with adding a member."),console.warn("error ->",r)):(e.notifier.success(e.ui.groups.memberAdded),e.statusBar.display(e.ui.groups.refreshingGroupMember),o.query().then(function(r){r.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",r)):(t.data=r,e.statusBar.off())}))})},t.removeMember=function(r,n){e.statusBar.display(e.ui.groups.removingMember),o.removeMember(r,n).then(function(r){r.error?(e.notifier.error("Error with removing a member."),console.warn("error ->",r)):(e.notifier.success(e.ui.groups.memberRemoved),e.statusBar.display(e.ui.groups.refreshingGroupMember),o.query().then(function(r){r.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",r)):(t.data=r,e.statusBar.off())}))})},t.removeMembers=function(r,n){e.statusBar.display(e.ui.groups.removingSelected),o.removeMembers(r,n).then(function(r){r.error?(e.notifier.error("Error with removing members."),console.warn("error ->",r)):(e.notifier.success(e.ui.groups.removed),e.statusBar.display(e.ui.groups.refreshingGroupMember),t.selection={},o.query().then(function(r){r.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",r)):(t.data=r,e.statusBar.off())}))})},t.groupSubmit=function(n){e.statusBar.display(e.ui.groups.saving),o.save(n).then(function(n){n.error?(e.notifier.error("Error with saving group."),console.warn("error ->",n)):(e.notifier.success(e.ui.groups.groupSaved),e.statusBar.display(e.ui.groups.refreshingGroupMember),o.query().then(function(o){o.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",o)):(t.closeTabs(),t.data=o,angular.forEach(o.groups,function(e){e.uuid==n&&(t.groups=o.groups,angular.forEach(o.groups,function(r){r.uuid==e.uuid&&(t.group=r)}),t.members=o.members[e.uuid],t.current=e.uuid,t.$watch(r.search(),function(){r.search({uuid:e.uuid})}))}),e.statusBar.off())}))})},t.memberSubmit=function(n){e.statusBar.display(e.ui.groups.registerNew),a.register(n).then(function(a){a.error?(e.notifier.error("Error with registering a member."),console.warn("error ->",a)):(e.notifier.success(e.ui.groups.memberRegstered),e.statusBar.display(e.ui.groups.refreshingGroupMember),o.query().then(function(o){o.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",o)):(t.data=o,r.path("/profile/"+n.username).hash("profile"),e.statusBar.off())}))})},t.deleteGroup=function(n){e.statusBar.display(e.ui.groups.deleting),o.remove(n).then(function(n){n.error?(e.notifier.error("Error with deleting a group."),console.warn("error ->",n)):(e.notifier.success(e.ui.groups.deleted),e.statusBar.display(e.ui.groups.refreshingGroupMember),o.query().then(function(n){n.error?(e.notifier.error("Error with getting groups and users."),console.warn("error ->",n)):(t.data=n,angular.forEach(n.groups,function(){t.groups=n.groups,t.group=n.groups[0],t.members=n.members[n.groups[0].uuid],t.current=n.groups[0].uuid,t.$watch(r.search(),function(){r.search({uuid:n.groups[0].uuid})})}),e.statusBar.off())}))})},t.toggleSelection=function(e,r){var n=r?!0:!1,o=angular.fromJson(u.get(e.uuid));angular.forEach(o,function(e){t.selection[e.uuid]=n})},t.fetchParent=function(){o.parents().then(function(e){console.warn("parent -> ",e)})},t.fetchContainers=function(e){o.containers(e).then(function(e){console.warn("containers -> ",e)})}}]).controller("profileCtrl",["$rootScope","$scope","$q","$location","$window","$route","data","Profile","Storage","Groups","Dater","Slots","Sloter","MD5",function(e,t,r,n,o,a,s,i,u,c,l,d,g,f){function m(r){t.views={profile:!1,edit:!1,password:!1,timeline:!1},t.views[r]=!0,t.views.user=e.app.resources.uuid==a.current.params.userId?!0:!1}function p(){var e=S.timeline.getVisibleChartRange();t.$apply(function(){t.timeline.range={start:""+new Date(e.from),end:""+new Date(e.till)}})}function h(){var r;if(r=S.timeline.getSelection()[0]){var n=S.timeline.getItem(r.row),o=angular.fromJson(n.content.match(/<span class="secret">(.*)<\/span>/)[1]);return t.original={start:n.start,end:n.end,content:{recursive:o.recursive,state:o.state,id:o.id}},t.forms={add:!1,edit:!0},t.slot={start:{date:new Date(n.start).toString(e.config.formats.date),time:new Date(n.start).toString(e.config.formats.time),datetime:new Date(n.start).toISOString()},end:{date:new Date(n.end).toString(e.config.formats.date),time:new Date(n.end).toString(e.config.formats.time),datetime:new Date(n.end).toISOString()},state:o.state,recursive:o.recursive,id:o.id},n}}function w(){t.$apply(function(){t.selectedOriginal=h()})}function v(){var r=$(".timeline-event-content").contents().filter(function(){return"New"==this.nodeValue}),n=S.timeline.getItem(S.timeline.getSelection()[0].row);r.length>1&&S.timeline.cancelAdd(),t.$apply(function(){t.forms={add:!0,edit:!1},t.slot={start:{date:new Date(n.start).toString(e.config.formats.date),time:new Date(n.start).toString(e.config.formats.time),datetime:new Date(n.start).toISOString()},end:{date:new Date(n.end).toString(e.config.formats.date),time:new Date(n.end).toString(e.config.formats.time),datetime:new Date(n.end).toISOString()},recursive:n.group.match(/recursive/)?!0:!1,state:"com.ask-cs.State.Available"}})}function y(r,n,o,a){if(!r)var s=S.timeline.getItem(S.timeline.getSelection()[0].row),a={start:s.start,end:s.end,content:angular.fromJson(s.content.match(/<span class="secret">(.*)<\/span>/)[1])};e.statusBar.display(e.ui.planboard.changingSlot),d.change(t.original,a,t.user.id).then(function(t){t.error?(e.notifier.error("Error with changing a timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.slotChanged),T.refresh()})}function b(){var r=$(".timeline-event-content").contents().filter(function(){return"New"==this.nodeValue});r.length>0?t.$apply(function(){t.resetInlineForms()}):(e.statusBar.display(e.ui.planboard.deletingTimeslot),d.remove(t.original,t.user.id).then(function(t){t.error?(e.notifier.error("Error with deleting a timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.timeslotDeleted),T.refresh()}))}e.fixStyles();var S=this,k=l.getPeriods(),D={day:Date.today().getDayOfYear()+1,week:(new Date).getWeek(),month:(new Date).getMonth()+1};t.data=s,t.user={id:a.current.params.userId},t.groups=c.getMemberGroups(a.current.params.userId),t.passwords={current:"",new1:"",new2:""},t.forms={add:!1,edit:!1},t.toggleSlotForm=function(){t.forms.add?t.resetInlineForms():(t.slot={},t.forms={add:!0,edit:!1})},t.resetInlineForms=function(){t.slot={},t.original={},t.forms={add:!1,edit:!1}},m(n.hash()),t.setViewTo=function(e){t.$watch(n.hash(),function(){n.hash(e),m(e)})},t.save=function(r){e.statusBar.display(e.ui.profile.saveProfile),i.save(a.current.params.userId,r).then(function(r){if(r.error)e.notifier.error("Error with saving profile information."),console.warn("error ->",r);else{e.statusBar.display(e.ui.profile.refreshing);var n=a.current.params.userId==e.app.resources.uuid?!0:!1;i.get(a.current.params.userId,n).then(function(r){r.error?(e.notifier.error("Error with getting profile data."),console.warn("error ->",r)):(e.notifier.success(e.ui.profile.dataChanged),t.data=r,e.statusBar.off())})}})},t.change=function(r){return""==r.new1||""==r.new2?(e.notifier.error(e.ui.profile.pleaseFill,!0),!1):r.new1!=r.new2?(e.notifier.error(e.ui.profile.passNotMatch,!0),!1):(e.app.resources.askPass==f(r.current)?(e.statusBar.display(e.ui.profile.changingPass),i.changePassword(r).then(function(r){r.error?(e.notifier.error("Error with changing password."),console.warn("error ->",r)):(e.statusBar.display(e.ui.profile.refreshing),i.get(e.app.resources.uuid,!0).then(function(r){r.error?(e.notifier.error("Error with getting profile data."),console.warn("error ->",r)):(e.notifier.success(e.ui.profile.passChanged),t.data=r,e.statusBar.off())}))})):e.notifier.error(e.ui.profile.passwrong,!0),void 0)};var T={init:function(){t.timeline={current:D,options:{start:new Date(k.weeks[D.week].first.day),end:new Date(k.weeks[D.week].last.day),min:new Date(k.weeks[D.week].first.day),max:new Date(k.weeks[D.week].last.day)},range:{start:k.weeks[D.week].first.day,end:k.weeks[D.week].last.day},config:{legenda:{},legendarer:e.config.timeline.config.legendarer,states:e.config.timeline.config.states}};var r={};angular.forEach(t.timeline.config.states,function(e,t){r[t]=e.label}),t.states=r,angular.forEach(e.config.timeline.config.states,function(e,r){t.timeline.config.legenda[r]=!0}),$("#timeline").html(""),$("#timeline").append('<div id="userTimeline"></div>'),S.timeline=new links.Timeline(document.getElementById("userTimeline")),links.events.addListener(S.timeline,"rangechanged",p),links.events.addListener(S.timeline,"add",v),links.events.addListener(S.timeline,"delete",b),links.events.addListener(S.timeline,"change",y),links.events.addListener(S.timeline,"select",w),this.render(t.timeline.options)},render:function(){angular.extend(t.timeline.options,e.config.timeline.options),setTimeout(function(){S.timeline.draw(g.profile(t.data.slots.data,t.timeline.config),t.timeline.options)},100),S.timeline.setVisibleChartRange(t.timeline.options.start,t.timeline.options.end),t.synced=s.synced},load:function(r){var n=this;e.statusBar.display(e.ui.planboard.refreshTimeline),i.getSlots(t.user.id,r).then(function(o){t.data.slots=o.slots,t.synced=o.synced,n.render(r),e.statusBar.off()})},refresh:function(){t.slot={},t.forms={add:!0,edit:!1},this.load({start:s.periods.start,end:s.periods.end})}};"timeline"==n.hash()&&T.init(),t.redraw=function(){T.init()},t.$watch(function(){if("timeline"==n.hash()){var e=S.timeline.getVisibleChartRange();t.timeline.range={start:""+new Date(e.start),end:""+new Date(e.end)}}}),t.slotAdd=function(r){e.statusBar.display(e.ui.planboard.addTimeSlot),d.add({start:e.browser.mobile?new Date(r.start.datetime).getTime()/1e3:l.convert.absolute(r.start.date,r.start.time,!0),end:e.browser.mobile?new Date(r.end.datetime).getTime()/1e3:l.convert.absolute(r.end.date,r.end.time,!0),recursive:r.recursive?!0:!1,text:r.state},t.user.id).then(function(t){t.error?(e.notifier.error("Error with adding a timeslot."),console.warn("error ->",t)):e.notifier.success(e.ui.planboard.slotAdded),T.refresh()})},t.slotChange=function(t,r){y(!0,t,r,{start:e.browser.mobile?new Date(r.start.datetime).getTime():l.convert.absolute(r.start.date,r.start.time,!1),end:e.browser.mobile?new Date(r.end.datetime).getTime():l.convert.absolute(r.end.date,r.end.time,!1),content:angular.toJson({recursive:r.recursive,state:r.state})})},t.slotRemove=function(){b()},t.timelineThisWeek=function(){t.timeline.current.week!=(new Date).getWeek()&&(T.load({start:k.weeks[(new Date).getWeek()].first.timeStamp,end:k.weeks[(new Date).getWeek()].last.timeStamp}),t.timeline.range={start:k.weeks[(new Date).getWeek()].first.day,end:k.weeks[(new Date).getWeek()].last.day})},t.timelineBefore=function(){1!=t.timeline.current.week&&(t.timeline.current.week--,T.load({start:k.weeks[t.timeline.current.week].first.timeStamp,end:k.weeks[t.timeline.current.week].last.timeStamp})),t.timeline.range={start:k.weeks[t.timeline.current.week].first.day,end:k.weeks[t.timeline.current.week].last.day}},t.timelineAfter=function(){53!=t.timeline.current.week&&(t.timeline.current.week++,T.load({start:k.weeks[t.timeline.current.week].first.timeStamp,end:k.weeks[t.timeline.current.week].last.timeStamp})),t.timeline.range={start:k.weeks[t.timeline.current.week].first.day,end:k.weeks[t.timeline.current.week].last.day}},o.onresize=function(){S.timeline.redraw()},t.timelineZoomIn=function(){S.timeline.zoom(e.config.timeline.config.zoom,Date.now())},t.timelineZoomOut=function(){S.timeline.zoom(-e.config.timeline.config.zoom,Date.now())},t.showLegenda=function(){t.timeline.config.legendarer=!t.timeline.config.legendarer},t.alterLegenda=function(e){t.timeline.config.legenda=e,T.render({start:t.timeline.range.start,end:t.timeline.range.end})}}]).controller("settingsCtrl",["$rootScope","$scope","$window","data","Settings","Profile","Storage",function(e,t,r,n,o,a,s){e.fixStyles(),t.settings=angular.fromJson(n);
var i={};angular.forEach(ui,function(e){i[e.meta.name]=e.meta.label}),t.languages=i;var u={};angular.forEach(s.local.groups(),function(e){u[e.uuid]=e.name}),t.groups=u,t.save=function(r){e.statusBar.display(e.ui.settings.saving),o.save(e.app.resources.uuid,r).then(function(){e.notifier.success(e.ui.settings.saved),e.statusBar.display(e.ui.settings.refreshing),a.get(e.app.resources.uuid,!0).then(function(r){r.error?(e.notifier.error("Error with saving settings."),console.warn("error ->",r)):(t.settings=angular.fromJson(r.resources.settingsWebPaige),e.changeLanguage(angular.fromJson(r.resources.settingsWebPaige).user.language),e.statusBar.off())})})},t.authGoogle=function(){window.location="http://3rc2.ask-services.appspot.com/auth/google?agentUrl=http://3rc2.ask-services.appspot.com/eveagents/personalagent/"+e.app.resources.uuid+"/"+"&agentMethod=createGoogleAgents"+"&applicationCallback="+location.protocol+"//"+location.hostname+(location.port&&":"+location.port)+"/index.html"+"?account="+e.app.resources.uuid+encodeURIComponent("#")+"/settings"}}]).controller("helpCtrl",["$rootScope","$scope",function(e){e.fixStyles()}]),angular.module("WebPaige.Directives",["ngResource"]).directive("chosen",function(){var e=function(e,t){e.$watch("receviersList",function(){t.trigger("liszt:updated")}),e.$watch("message.receviers",function(){$(t[0]).trigger("liszt:updated")}),t.chosen()};return{restrict:"A",link:e}}).directive("daterangepicker",["$rootScope",function(e){return{restrict:"A",link:function(t,r){r.daterangepicker({ranges:{Today:["today","tomorrow"],Tomorrow:["tomorrow",(new Date.today).addDays(2)],Yesterday:["yesterday","today"],"Next 3 Days":["today",(new Date.create).addDays(3)],"Next 7 Days":["today",(new Date.create).addDays(7)]}},function(r,n){t.$apply(function(){var o=n.getTime()-r.getTime();864e5>=o?(t.timeline.range={start:r,end:r},t.timeline.scope={day:!0,week:!1,month:!1}):6048e5>o?(t.timeline.range={start:r,end:n},t.timeline.scope={day:!1,week:!0,month:!1}):o>6048e5&&(t.timeline.range={start:r,end:n},t.timeline.scope={day:!1,week:!1,month:!0}),e.$broadcast("timeliner",{start:r,end:n})})}),r.attr("data-toggle","daterangepicker"),r.daterangepicker({autoclose:!0})}}}]).directive("wpName",["Storage",function(e){return{restrict:"A",link:function(t,r,n){var o=function(t){var r=angular.fromJson(e.get("members")),n=t;return angular.forEach(r,function(e){return e.uuid==t?(n=e.name,!1):void 0}),n};t.$watch(n.wpName,function(e){r.text(o(e))})}}}]),angular.module("WebPaige.Services",["ngResource"]).factory("Timer",["$rootScope","$timeout",function(e,t){var r=[],n=function(e,n,o){r[e]={event:n,delay:o,counter:0};var a=function(){r[e].counter++,r[e].mytimeout=t(a,1e3),r[e].delay==r[e].counter&&(r[e].event.call(),r[e].counter=0)};r[e].mytimeout=t(a,1e3)},o=function(e){t.cancel(r[e].mytimeout)};return{start:n,stop:o}}]).factory("Session",["$rootScope","$http","Storage",function(e,t,r){return{check:function(){var e=angular.fromJson(r.cookie.get("session"));return e?(this.set(e.id),!0):!1},cookie:function(){for(var e,t=document.cookie.split(";"),r=0;t.length>r;r++)if(e=t[r].split("="),"WebPaige.session"==e[0].trim())return angular.fromJson(e[1])},get:function(e){return this.check(e),this.set(e.id),e.id},set:function(n){var o={id:n,time:new Date};return r.cookie.add("session",angular.toJson(o)),e.session=o,t.defaults.headers.common["X-SESSION_ID"]=e.session.id,o},clear:function(){e.session=null,t.defaults.headers.common["X-SESSION_ID"]=null}}}]).factory("Dater",["$rootScope","Storage",function(e,t){return{current:{today:function(){return Date.today().getDayOfYear()+1},week:function(){return(new Date).getWeek()},month:function(){return(new Date).getMonth()+1}},readable:{date:function(t){return new Date(t).toString(e.config.formats.date)}},convert:{absolute:function(e,t,r){var n=e.split("-"),o=new Date(Date.parse(n[2]+"-"+n[1]+"-"+n[0]+" "+t)).getTime();return r?o/1e3:o}},calculate:{diff:function(e){return new Date(e.end).getTime()-new Date(e.start).getTime()}},getThisMonth:function(){return(new Date).toString("M")},getThisYear:function(){return(new Date).toString("yyyy")},getMonthTimeStamps:function(){for(var e={},t=this.getThisYear(),r=0;12>r;r++){var n=new Date(t,r).moveToFirstDayOfMonth(),o=new Date(t,r).moveToLastDayOfMonth(),a={first:{day:n,timeStamp:n.getTime()},last:{day:o,timeStamp:o.getTime()},totalDays:Date.getDaysInMonth(t,r)};e[r+1]=a}return e},getWeekTimeStamps:function(){for(var e,t=[],r={},n=this.getThisYear(),o=(new Date(n,0).moveToFirstDayOfMonth(),new Date(n,0).moveToFirstDayOfMonth().last().sunday().addWeeks(0)),a=new Date(o),s=0;53>s;s++)e=0==s?o.addWeeks(1):new Date(t[s-1]).addWeeks(1),t.push(new Date(e));t.unshift(a),new Date(t[51].addWeeks(1));for(var s=0;55>s;s++)r[s+1]={first:{day:t[s],timeStamp:new Date(t[s]).getTime()},last:{day:t[s+1],timeStamp:new Date(t[s+1]).getTime()}};return delete r[54],delete r[55],r},getDayTimeStamps:function(){for(var e,t=[],r={},n=this.getThisYear(),o=new Date(n,0).moveToFirstDayOfMonth(),a=0;366>a;a++)e=0==a?o:new Date(t[a-1]).addDays(1),t.push(new Date(e));for(var a=0;366>a;a++)r[a+1]={first:{day:t[a],timeStamp:new Date(t[a]).getTime()},last:{day:t[a+1],timeStamp:new Date(t[a+1]).getTime()}};return r[366].timeStamp?r.total=366:(delete r[366],r.total=365),r},registerPeriods:function(){angular.fromJson(t.get("periods")||"{}"),t.add("periods",angular.toJson({months:this.getMonthTimeStamps(),weeks:this.getWeekTimeStamps(),days:this.getDayTimeStamps()}))},getPeriods:function(){return angular.fromJson(t.get("periods"))}}}]).factory("EventBus",["$rootScope",function(e){var t=this,r={};t.emit=function(){var t=Array.prototype.slice.call(arguments,1);angular.forEach(r,function(r,n){angular.forEach(r,function(r){t.length?e.$emit(n,r(t)):e.$emit(n,r())})})},t.on=function(t,n){r[t]instanceof Array||(r[t]=[]),r[t].push(n),e.$on(r[t],n)},t.remove=function(e,t){var n=r[e],o=n instanceof Array?n.indexOf(t):-1;o>-1&&r[e].splice(o,1)},t.removeAll=function(e){e?r[e]=[]:r={}}}]).factory("Interceptor",["$q","$location",function(e,t){return function(r){return r.then(function(e){return e},function(r){return 403==r.status&&(alert("Session timeout , please re-login"),t.path("/login")),e.reject(r)})}}]).factory("MD5",function(){return function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,n,o,a,s;return o=2147483648&e,a=2147483648&t,r=1073741824&e,n=1073741824&t,s=(1073741823&e)+(1073741823&t),r&n?2147483648^s^o^a:r|n?1073741824&s?3221225472^s^o^a:1073741824^s^o^a:s^o^a}function n(e,t,r){return e&t|~e&r}function o(e,t,r){return e&r|t&~r}function a(e,t,r){return e^t^r}function s(e,t,r){return t^(e|~r)}function i(e,o,a,s,i,u,c){return e=r(e,r(r(n(o,a,s),i),c)),r(t(e,u),o)}function u(e,n,a,s,i,u,c){return e=r(e,r(r(o(n,a,s),i),c)),r(t(e,u),n)}function c(e,n,o,s,i,u,c){return e=r(e,r(r(a(n,o,s),i),c)),r(t(e,u),n)}function l(e,n,o,a,i,u,c){return e=r(e,r(r(s(n,o,a),i),c)),r(t(e,u),n)}function d(e){for(var t,r=e.length,n=r+8,o=(n-n%64)/64,a=16*(o+1),s=Array(a-1),i=0,u=0;r>u;)t=(u-u%4)/4,i=8*(u%4),s[t]=s[t]|e.charCodeAt(u)<<i,u++;return t=(u-u%4)/4,i=8*(u%4),s[t]=s[t]|128<<i,s[a-2]=r<<3,s[a-1]=r>>>29,s}function g(e){var t,r,n="",o="";for(r=0;3>=r;r++)t=255&e>>>8*r,o="0"+t.toString(16),n+=o.substr(o.length-2,2);return n}function f(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;e.length>r;r++){var n=e.charCodeAt(r);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(192|n>>6),t+=String.fromCharCode(128|63&n)):(t+=String.fromCharCode(224|n>>12),t+=String.fromCharCode(128|63&n>>6),t+=String.fromCharCode(128|63&n))}return t}var m,p,h,w,v,y,b,S,k,D=[],$=7,T=12,E=17,M=22,x=5,P=9,B=14,I=20,C=4,A=11,J=16,W=23,q=6,N=10,O=15,G=21;for(e=f(e),D=d(e),y=1732584193,b=4023233417,S=2562383102,k=271733878,m=0;D.length>m;m+=16)p=y,h=b,w=S,v=k,y=i(y,b,S,k,D[m+0],$,3614090360),k=i(k,y,b,S,D[m+1],T,3905402710),S=i(S,k,y,b,D[m+2],E,606105819),b=i(b,S,k,y,D[m+3],M,3250441966),y=i(y,b,S,k,D[m+4],$,4118548399),k=i(k,y,b,S,D[m+5],T,1200080426),S=i(S,k,y,b,D[m+6],E,2821735955),b=i(b,S,k,y,D[m+7],M,4249261313),y=i(y,b,S,k,D[m+8],$,1770035416),k=i(k,y,b,S,D[m+9],T,2336552879),S=i(S,k,y,b,D[m+10],E,4294925233),b=i(b,S,k,y,D[m+11],M,2304563134),y=i(y,b,S,k,D[m+12],$,1804603682),k=i(k,y,b,S,D[m+13],T,4254626195),S=i(S,k,y,b,D[m+14],E,2792965006),b=i(b,S,k,y,D[m+15],M,1236535329),y=u(y,b,S,k,D[m+1],x,4129170786),k=u(k,y,b,S,D[m+6],P,3225465664),S=u(S,k,y,b,D[m+11],B,643717713),b=u(b,S,k,y,D[m+0],I,3921069994),y=u(y,b,S,k,D[m+5],x,3593408605),k=u(k,y,b,S,D[m+10],P,38016083),S=u(S,k,y,b,D[m+15],B,3634488961),b=u(b,S,k,y,D[m+4],I,3889429448),y=u(y,b,S,k,D[m+9],x,568446438),k=u(k,y,b,S,D[m+14],P,3275163606),S=u(S,k,y,b,D[m+3],B,4107603335),b=u(b,S,k,y,D[m+8],I,1163531501),y=u(y,b,S,k,D[m+13],x,2850285829),k=u(k,y,b,S,D[m+2],P,4243563512),S=u(S,k,y,b,D[m+7],B,1735328473),b=u(b,S,k,y,D[m+12],I,2368359562),y=c(y,b,S,k,D[m+5],C,4294588738),k=c(k,y,b,S,D[m+8],A,2272392833),S=c(S,k,y,b,D[m+11],J,1839030562),b=c(b,S,k,y,D[m+14],W,4259657740),y=c(y,b,S,k,D[m+1],C,2763975236),k=c(k,y,b,S,D[m+4],A,1272893353),S=c(S,k,y,b,D[m+7],J,4139469664),b=c(b,S,k,y,D[m+10],W,3200236656),y=c(y,b,S,k,D[m+13],C,681279174),k=c(k,y,b,S,D[m+0],A,3936430074),S=c(S,k,y,b,D[m+3],J,3572445317),b=c(b,S,k,y,D[m+6],W,76029189),y=c(y,b,S,k,D[m+9],C,3654602809),k=c(k,y,b,S,D[m+12],A,3873151461),S=c(S,k,y,b,D[m+15],J,530742520),b=c(b,S,k,y,D[m+2],W,3299628645),y=l(y,b,S,k,D[m+0],q,4096336452),k=l(k,y,b,S,D[m+7],N,1126891415),S=l(S,k,y,b,D[m+14],O,2878612391),b=l(b,S,k,y,D[m+5],G,4237533241),y=l(y,b,S,k,D[m+12],q,1700485571),k=l(k,y,b,S,D[m+3],N,2399980690),S=l(S,k,y,b,D[m+10],O,4293915773),b=l(b,S,k,y,D[m+1],G,2240044497),y=l(y,b,S,k,D[m+8],q,1873313359),k=l(k,y,b,S,D[m+15],N,4264355552),S=l(S,k,y,b,D[m+6],O,2734768916),b=l(b,S,k,y,D[m+13],G,1309151649),y=l(y,b,S,k,D[m+4],q,4149444226),k=l(k,y,b,S,D[m+11],N,3174756917),S=l(S,k,y,b,D[m+2],O,718787259),b=l(b,S,k,y,D[m+9],G,3951481745),y=r(y,p),b=r(b,h),S=r(S,w),k=r(k,v);var L=g(y)+g(b)+g(S)+g(k);return L.toLowerCase()}}).factory("Storage",["$rootScope","$config",function(e,t){"."!==t.title.substr(-1)&&(t.title=t.title?t.title+".":"");var r=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},n=function(e,n){if(!r())return!1;if(!n&&0!==n&&""!==n)return!1;try{localStorage.setItem(t.title+e,n)}catch(o){return!1}return!0},o=function(e){if(!r())return!1;var n=localStorage.getItem(t.title+e);return n?n:null},a=function(e){if(!r())return!1;try{localStorage.removeItem(t.title+e)}catch(n){return!1}return!0},s=function(){if(!r())return!1;var e=t.title.length;for(var n in localStorage)if(n.substr(0,e)===t.title)try{a(n.substr(e))}catch(o){return!1}return!0},i=function(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(e){return!1}},u=function(e,r){if(!i())return!1;if(!r&&0!==r&&""!==r)return!1;try{sessionStorage.setItem(t.title+e,r)}catch(n){return!1}return!0},c=function(e){if(!i())return!1;var r=sessionStorage.getItem(t.title+e);return r?r:null},l=function(e){if(!i())return!1;try{sessionStorage.removeItem(t.title+e)}catch(r){return!1}return!0},d=function(){if(!i())return!1;var e=t.title.length;for(var r in sessionStorage)if(r.substr(0,e)===t.title)try{l(r.substr(e))}catch(n){return!1}return!0},g=function(){try{return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}catch(e){return!1}},f=function(e,r){if(r===void 0)return!1;if(!g())return!1;try{var n="",o=new Date;null===r&&(t.cookie.expiry=-1,r=""),0!==t.cookie.expiry&&(o.setTime(o.getTime()+1e3*60*60*t.cookie.expiry),n="; expires="+o.toGMTString()),document.cookie=t.title+e+"="+r+n+"; path="+t.cookie.path}catch(a){return!1}return!0},m=function(r){if(!g())return e.$broadcast("StorageModule.notification.error","COOKIES_NOT_SUPPORTED"),!1;for(var n=document.cookie.split(";"),o=0;n.length>o;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t.title+r+"="))return decodeURIComponent(a.substring(t.title.length+r.length+1,a.length))}return null},p=function(e){f(e,null)},h=function(){for(var e=null,r=t.title.length,n=document.cookie.split(";"),o=0;n.length>o;o++){for(e=n[o];" "==e.charAt(0);)e=e.substring(1,e.length);key=e.substring(r,e.indexOf("=")),p(key)}},w=function(){return angular.fromJson(o("periods"))},v=function(){return angular.fromJson(o("groups"))},y=function(){return angular.fromJson(o("members"))},b=function(){var t=angular.fromJson(o("resources"));return t.settingsWebPaige?angular.fromJson(t.settingsWebPaige):e.config.defaults.settingsWebPaige};return{isSupported:r,add:n,get:o,remove:a,clearAll:s,session:{add:u,get:c,remove:l,clearAll:d},cookie:{add:f,get:m,remove:p,clearAll:h},local:{periods:w,groups:v,members:y,settings:b}}}]).factory("Strings",function(){return{truncate:function(e,t,r){var n=e.length>t,o=n?e.substr(0,t-1):e,o=r&&n?o.substr(0,o.lastIndexOf(" ")):o;return n?o+"..":o}}}).factory("Announcer",function(){return{process:function(e){var t={"short":[],"long":[]},r=0;return angular.forEach(e,function(e){e.body&&((e.body.match(/Prio 1/)||e.body.match(/PRIO 1/))&&(e.body=e.body.replace("Prio 1 ",""),e.prio={1:!0,test:!1}),(e.body.match(/Prio 2/)||e.body.match(/PRIO 2/))&&(e.body=e.body.replace("Prio 2 ",""),e.prio={2:!0,test:!1}),(e.body.match(/Prio 3/)||e.body.match(/PRIO 3/))&&(e.body=e.body.replace("Prio 3 ",""),e.prio={3:!0,test:!1}),e.body.match(/PROEFALARM/)&&(e.prio={test:!0}),4>r&&t.short.push(e),t.long.push(e),r++)}),t}}}).factory("Sloter",["$rootScope","Storage",function(e,t){return{get:{groups:function(){var e={};return angular.forEach(t.local.groups(),function(t){e[t.uuid]=t.name}),e},members:function(){var e={};return angular.forEach(t.local.members(),function(t){e[t.uuid]=t.name}),e}},wrapper:function(e){return'<span style="display:none;">'+e+"</span>"},secret:function(e){return'<span class="secret">'+e+"</span>"},addLoading:function(e,t,r){return angular.forEach(r,function(r){t.push({start:e.periods.end,end:15778368e5,group:r,content:"loading",className:"state-loading-right",editable:!1}),t.push({start:0,end:e.periods.start,group:r,content:"loading",className:"state-loading-left",editable:!1})}),t},user:function(t,r,n){var o=this;return angular.forEach(t.user,function(t){angular.forEach(n.legenda,function(a,s){t.text==s&&a&&r.push({start:Math.round(1e3*t.start),end:Math.round(1e3*t.end),group:t.recursive?o.wrapper("b")+e.ui.planboard.weeklyPlanning+o.wrapper("recursive"):o.wrapper("a")+e.ui.planboard.planning+o.wrapper("planning"),content:o.secret(angular.toJson({type:"slot",id:t.id,recursive:t.recursive,state:t.text})),className:n.states[t.text].className,editable:!0})})}),r=o.addLoading(t,r,[o.wrapper("b")+e.ui.planboard.weeklyPlanning+o.wrapper("recursive"),o.wrapper("a")+e.ui.planboard.planning+o.wrapper("planning")])},profile:function(t,r){var n=this,o=[];return angular.forEach(t,function(t){angular.forEach(r.legenda,function(a,s){t.text==s&&a&&o.push({start:Math.round(1e3*t.start),end:Math.round(1e3*t.end),group:t.recursive?n.wrapper("b")+e.ui.planboard.weeklyPlanning+n.wrapper("recursive"):n.wrapper("a")+e.ui.planboard.planning+n.wrapper("planning"),content:n.secret(angular.toJson({type:"slot",id:t.id,recursive:t.recursive,state:t.text})),className:r.states[t.text].className,editable:!0})})}),o.push({start:0,end:1,group:n.wrapper("b")+e.ui.planboard.weeklyPlanning+n.wrapper("recursive"),content:"",className:null,editable:!1}),o.push({start:0,end:1,group:n.wrapper("a")+e.ui.planboard.planning+n.wrapper("planning"),content:"",className:null,editable:!1}),o},namer:function(e,t,r){var n,o=this.get.groups(),a=o[e.aggs.id],s='<a href="#/groups?uuid='+e.aggs.id+'#view">'+a+"</a>";if("all"==e.aggs.division||void 0==e.aggs.division)n=1==r?s:"<span>"+a+"</span>";else{var i;angular.forEach(t,function(t){t.id==e.aggs.division&&(i=t.label)}),n=1==r?s:"<span>"+a+"</span>",n+=' <span class="label">'+i+"</span>"}return n},bars:function(e,t,r,n){var o=this,a=0;return angular.forEach(e.aggs.data,function(e){e.wish>a&&(a=e.wish)}),angular.forEach(e.aggs.data,function(s){var i=a,u=s.wish,c=u,l=Math.round(80*(u/i)+20),d=l,g="height:"+l+"px;",f='<div class="requirement" style="'+g+'" '+'title="'+"Minimum aantal benodigden"+": "+u+' personen"></div>';u=s.wish+s.diff;var m=u;if(l=Math.round(80*(u/i)+20),s.diff>=0&&7>s.diff)switch(s.diff){case 0:var p=r.densities.even;break;case 1:var p=r.densities.one;break;case 2:var p=r.densities.two;break;case 3:var p=r.densities.three;break;case 4:var p=r.densities.four;break;case 5:var p=r.densities.five;break;case 6:var p=r.densities.six}else if(s.diff>=7)var p=r.densities.more;else var p=r.densities.less;var h='<span class="badge badge-inverse">'+s.diff+"</span>";m>c&&(l=d),g="height:"+l+"px;"+"background-color: "+p+";";var w='<div class="bar" style="'+g+'" '+' title="Huidig aantal beschikbaar: '+u+' personen">'+h+"</div>";(s.diff>0&&r.legenda.groups.more||0==s.diff&&r.legenda.groups.even||0>s.diff&&r.legenda.groups.less)&&t.push({start:Math.round(1e3*s.start),end:Math.round(1e3*s.end),group:o.wrapper("c")+n,content:f+w+o.secret(angular.toJson({type:"group",diff:s.diff,group:n})),className:"group-aggs",editable:!1}),t=o.addLoading(e,t,[o.wrapper("c")+n])}),t},aggs:function(e,t,r,n){var o=this;return angular.forEach(e.aggs.data,function(a){var s;if(a.diff>=0&&7>a.diff)switch(a.diff){case 0:s="even";break;case 1:s=1;break;case 2:s=2;break;case 3:s=3;break;case 4:s=4;break;case 5:s=5;break;case 6:s=6}else s=a.diff>=7?"more":"less";(a.diff>0&&r.legenda.groups.more||0==a.diff&&r.legenda.groups.even||0>a.diff&&r.legenda.groups.less)&&t.push({start:Math.round(1e3*a.start),end:Math.round(1e3*a.end),group:o.wrapper("c")+n,content:s+o.secret(angular.toJson({type:"group",diff:a.diff,group:n})),className:"agg-"+s,editable:!1}),t=o.addLoading(e,t,[o.wrapper("c")+n])}),t},wishes:function(e,t,r){var n=this;return angular.forEach(e.aggs.wishes,function(o){if(o.count>=7)var a="wishes-more";else if(0==o.count)var a="wishes-even";else var a="wishes-"+o.count;t.push({start:Math.round(1e3*o.start),end:Math.round(1e3*o.end),group:n.wrapper("c")+r+" (Wishes)",content:'<span class="badge badge-inverse">'+o.count+"</span>"+n.secret(angular.toJson({type:"wish",wish:o.count,group:r,groupId:e.aggs.id})),className:a,editable:!1}),t=n.addLoading(e,t,[n.wrapper("c")+r+" (Wishes)"])}),t},members:function(e,t,r,n){var o=this,a=this.get.members();return angular.forEach(e.members,function(s){var i=1==n?o.wrapper("d")+'<a href="#/profile/'+s.id+'#timeline">'+a[s.id]+"</a>":o.wrapper("d")+a[s.id];angular.forEach(s.data,function(e){angular.forEach(r.legenda,function(n,a){e.text==a&&n&&t.push({start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),group:i,content:o.secret(angular.toJson({type:"member",id:e.id,mid:s.id,recursive:e.recursive,state:e.text})),className:r.states[e.text].className,editable:!1})})}),t.push({start:0,end:0,group:i,content:null,className:null,editable:!1}),t=o.addLoading(e,t,[i]),angular.forEach(s.stats,function(e){var t=e.state.split(".");t.reverse(),e.state="bar-"+t[0]})}),t},pies:function(e){document.getElementById("groupPie").innerHTML="";var t=[],r={more:"#415e6b",even:"#ba6a24",less:"#a0a0a0"},n=[],o=[];angular.forEach(e.aggs.ratios,function(e,n){0!=e&&t.push({ratio:e,color:r[n]})}),t=t.sort(function(e,t){return t.ratio-e.ratio}),angular.forEach(t,function(e){n.push(e.color),o.push(e.ratio)});var a=Raphael("groupPie");a.piechart(120,120,100,o,{colors:n})},process:function(e,t,r,n){var o=this,a=[];if(e.user&&(a=o.user(e,a,t)),e.aggs){var s=o.namer(e,r,n);a=t.bar?o.bars(e,a,t,s):o.aggs(e,a,t,s)}return t.wishes&&(a=o.wishes(e,a,s)),e.members&&(a=o.members(e,a,t,n)),e.aggs&&e.aggs.ratios&&o.pies(e),a}}}]).factory("Stats",["$rootScope","Storage",function(){return{aggs:function(e){var t={less:0,even:0,more:0},r={less:0,even:0,more:0,total:0},n=e.length;return angular.forEach(e,function(e){0>e.diff?t.less++:0==e.diff?t.even++:t.more++;var n=e.end-e.start;0>e.diff?r.less=r.less+n:0==e.diff?r.even=r.even+n:r.more=r.more+n,r.total=r.total+n}),{ratios:{less:Math.round(100*(t.less/n)),even:Math.round(100*(t.even/n)),more:Math.round(100*(t.more/n))},durations:r}},pies:function(e){var t={less:0,even:0,more:0},r=e.length;return angular.forEach(e,function(e){0>e.diff?t.less++:0==e.diff?t.even++:t.more++}),{less:Math.round(100*(t.less/r)),even:Math.round(100*(t.even/r)),more:Math.round(100*(t.more/r))}},member:function(e){var t={},r=0;angular.forEach(e,function(e){t[e.text]?t[e.text]++:t[e.text]=1,r++});var n=[];return angular.forEach(t,function(e,t){n.push({state:t,ratio:100*(e/r)})}),n}}}]),angular.module("WebPaige.Filters",["ngResource"]).filter("translateRole",["$config",function(e){return function(t){var r;return angular.forEach(e.roles,function(e){e.id==t&&(r=e.label)}),r}}]).filter("rangeMainFilter",["Dater","Storage",function(e){var t=e.getPeriods();return function(r){86401e3==new Date(r.end).getTime()-new Date(r.start).getTime()&&(r.start=new Date(r.end).addDays(-1));var r={start:{real:new Date(r.start).toString("dddd, MMMM d"),month:new Date(r.start).toString("MMMM"),day:new Date(r.start).toString("d")},end:{real:new Date(r.end).toString("dddd, MMMM d"),month:new Date(r.end).toString("MMMM"),day:new Date(r.end).toString("d")}},n=Date.getMonthNumberFromName(r.start.month);return(Math.round(r.start.day)+1==r.end.day&&r.start.hour==r.end.hour||r.start.day==r.end.day)&&r.start.month==r.end.month?r.start.real+", "+e.getThisYear():1==r.start.day&&r.end.day==t.months[n+1].totalDays?r.start.month+", "+e.getThisYear():r.start.real+" / "+r.end.real+", "+e.getThisYear()}}]).filter("rangeMainWeekFilter",["Dater","Storage",function(e){return e.getPeriods(),function(t){if(t){var t={start:new Date(t.start).toString("dddd, MMMM d"),end:new Date(t.end).toString("dddd, MMMM d")};return t.start+" / "+t.end+", "+e.getThisYear()}}}]).filter("rangeInfoFilter",["Dater","Storage",function(e){var t=e.getPeriods();return function(e){var r=new Date(e.range.end).getTime()-new Date(e.range.start).getTime();if(r>26784e5)return"Total selected days: "+Math.round(r/864e5);if(e.scope.day){var n={start:new Date(e.range.start).toString("HH:mm"),end:new Date(e.range.end).toString("HH:mm")};return"00:00"==n.end&&(n.end="24:00"),"Time: "+n.start+" / "+n.end}return e.scope.week?"Week number: "+e.current.week:e.scope.month?"Month number: "+e.current.month+", Total days: "+t.months[e.current.month].totalDays:void 0}}]).filter("rangeInfoWeekFilter",["Dater","Storage",function(e){return e.getPeriods(),function(e){return e?"Week number: "+e.current.week:void 0}}]).filter("convertRatios",["$config",function(){return function(e){var t="";return angular.forEach(e,function(e){t+=e.ratio.toFixed(1)+"% "+e.state.replace(/^bar-+/,"")+", "}),t.substring(0,t.length-2)}}]).filter("calculateTimeInDays",function(){return function(e){var t=864e5,r=0,n=0,e=1e3*e,n=e%t,r=e-n;return Math.floor(r/t)}}).filter("calculateTimeInHours",function(){return function(e){var t=864e5,r=36e5,n=0,e=1e3*e,n=e%t;return Math.floor(n/r)}}).filter("calculateTimeInMinutes",function(){return function(e){var t=36e5,r=6e4,n=0,e=1e3*e,n=e%t;return Math.floor(n/r)}}).filter("convertEve",function(){return function(e){var t=e;return t=e!==void 0?e.split("/"):["",e,""],t[t.length-2]}}).filter("convertUserIdToName",["Storage",function(e){var t=angular.fromJson(e.get("members"));return function(e){return null==t||t[e]===void 0?e:t[e].name}}]).filter("nicelyDate",["$rootScope",function(e){return function(t){return"string"==typeof t&&(t=Number(t)),new Date(t).toString(e.config.formats.datetime)}}]).filter("convertTimeStamp",function(){return function(e){return console.warn(typeof e),new Date(e).toString("dd-MM-yyyy HH:mm")}}).filter("noTitle",function(){return function(e){return""==e?"- No Title -":e}}).filter("stripSpan",function(){return function(e){return e.match(/<span class="label">(.*)<\/span>/)}}).filter("stripHtml",function(){return function(e){return e?e.split(">")[1].split("<")[0]:void 0}}).filter("groupIdToName",["Storage",function(e){return function(t){var r=angular.fromJson(e.get("groups"));for(var n in r)if(r[n].uuid==t)return r[n].name}}]).filter("i18n_spec",["$rootScope",function(e){return function(t,r){var n=r.split("."),o=e.ui[n[0]][n[1]],o=o.replace("$v",t);return o}}]).filter("truncateGroupTitle",["Strings",function(e){return function(t){return e.truncate(t,20,!0)}}]);